INFO:api.embeddings.utils.helper:================================================================================
INFO:api.embeddings.utils.helper:EMBEDDING CONFIGURATION
INFO:api.embeddings.utils.helper:================================================================================
INFO:api.embeddings.utils.helper:Provider: OLLAMA
INFO:api.embeddings.utils.helper:  Ollama URL: http://100.91.76.71:11434
INFO:api.embeddings.utils.helper:  Model: mxbai-embed-large:latest
INFO:api.embeddings.utils.helper:  ✓ Model 'mxbai-embed-large:latest' is available
INFO:api.embeddings.utils.helper:================================================================================
INFO:     Started server process [34220]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2026-02-02 15:37:21,062 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 15:37:21,063 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
Warning: /agent/health not reachable
Warning: /retrieval/rerank/health not reachable
INFO:     127.0.0.1:60107 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 15:37:21,070 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 15:37:21,070 - api.access - INFO - Body: {
  "query": "What active conditions does patient 179713d4-6c3d-4397-81f4-687dc9d7e609 have?",
  "session_id": "golden-candidate-0",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
}
INFO:api.access:Body: {
  "query": "What active conditions does patient 179713d4-6c3d-4397-81f4-687dc9d7e609 have?",
  "session_id": "golden-candidate-0",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:37:24,177 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:37:24,177 - api.access - INFO - Body: {
  "query": "active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
Some weights of BertForSequenceClassification were not initialized from the model checkpoint at sentence-transformers/all-MiniLM-L6-v2 and are newly initialized: ['classifier.bias', 'classifier.weight']
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
[GRAPH] Creating complex multi-agent graph (researcher → validator → respond)
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  8.29it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  8.28it/s]
2026-02-02 15:37:31,482 - api.access - INFO - Response: 200 in 7.3051s
INFO:api.access:Response: 200 in 7.3051s
INFO:     127.0.0.1:60116 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:37:44,125 - api.access - INFO - Request: GET /health
INFO:api.access:Request: GET /health
2026-02-02 15:37:44,128 - api.access - INFO - Response: 200 in 0.0023s
INFO:api.access:Response: 200 in 0.0023s
INFO:     127.0.0.1:60154 - "GET /health HTTP/1.1" 200 OK
2026-02-02 15:37:44,140 - api.access - INFO - Request: GET /health
INFO:api.access:Request: GET /health
2026-02-02 15:37:44,141 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:60156 - "GET /health HTTP/1.1" 200 OK
2026-02-02 15:37:44,147 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 15:37:44,147 - api.access - INFO - Body: {
  "query": "List all active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609.",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-1"
}
INFO:api.access:Body: {
  "query": "List all active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609.",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-1"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:37:49,211 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 15:37:49,211 - api.access - INFO - Response: 200 in 0.0011s
INFO:api.access:Response: 200 in 0.0011s
INFO:     127.0.0.1:60171 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 15:37:49,213 - api.access - INFO - Request: GET /retrieval/rerank/health
INFO:api.access:Request: GET /retrieval/rerank/health
2026-02-02 15:37:49,214 - api.access - INFO - Response: 200 in 0.0010s
INFO:api.access:Response: 200 in 0.0010s
INFO:     127.0.0.1:60173 - "GET /retrieval/rerank/health HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:37:53,177 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:37:53,177 - api.access - INFO - Body: {
  "query": "MedicationRequest/urn:uuid:c681883c-b263-eab78fc3b448",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "MedicationRequest/urn:uuid:c681883c-b263-eab78fc3b448",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:37:55,879 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:37:55,879 - api.access - INFO - Body: {
  "query": "active conditions",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "active conditions",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-37' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 19.12it/s]
2026-02-02 15:38:01,279 - api.access - INFO - Response: 200 in 8.1014s
INFO:api.access:Response: 200 in 8.1014s
INFO:     127.0.0.1:60187 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
Warning: Only found 4/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.93it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.93it/s]
2026-02-02 15:38:02,233 - api.access - INFO - Response: 200 in 6.3536s
INFO:api.access:Response: 200 in 6.3536s
INFO:     127.0.0.1:60204 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:38:22,882 - api.access - INFO - Response: 200 in 61.8117s
INFO:api.access:Response: 200 in 61.8117s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:60109 - "POST /agent/query HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:38:28,312 - api.access - INFO - Response: 200 in 44.1650s
INFO:api.access:Response: 200 in 44.1650s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:60158 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 15:38:28,342 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 15:38:28,342 - api.access - INFO - Body: {
  "query": "What was patient 179713d4-6c3d-4397-81f4-687dc9d7e609's weight on 2010-12-07?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-2"
}
INFO:api.access:Body: {
  "query": "What was patient 179713d4-6c3d-4397-81f4-687dc9d7e609's weight on 2010-12-07?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-2"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=37106-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:38:41,295 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:38:41,295 - api.access - INFO - Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.08it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.07it/s]
2026-02-02 15:38:46,030 - api.access - INFO - Response: 200 in 4.7358s
INFO:api.access:Response: 200 in 4.7358s
INFO:     127.0.0.1:60283 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:39:02,895 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:39:02,895 - api.access - INFO - Body: {
  "query": "Patient weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Patient weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-138' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-168' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-333' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.35it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.34it/s]
2026-02-02 15:39:07,787 - api.access - INFO - Response: 200 in 4.8919s
INFO:api.access:Response: 200 in 4.8919s
INFO:     127.0.0.1:60305 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:39:20,747 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:39:20,747 - api.access - INFO - Body: {
  "query": "weight on 2010-12-07 for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight on 2010-12-07 for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 36.91it/s]
2026-02-02 15:39:24,768 - api.access - INFO - Response: 200 in 4.0218s
INFO:api.access:Response: 200 in 4.0218s
INFO:     127.0.0.1:60323 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:39:38,008 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:39:38,008 - api.access - INFO - Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
2026-02-02 15:39:41,942 - api.access - INFO - Response: 200 in 3.9337s
INFO:api.access:Response: 200 in 3.9337s
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
INFO:     127.0.0.1:60339 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:39:57,207 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:39:57,207 - api.access - INFO - Body: {
  "query": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.34it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.47it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.19it/s]
2026-02-02 15:40:02,722 - api.access - INFO - Response: 200 in 5.5142s
INFO:api.access:Response: 200 in 5.5142s
INFO:     127.0.0.1:60356 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8480-6 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:40:16,330 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:40:16,330 - api.access - INFO - Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-391' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-449' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-507' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-566' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 15:40:20,653 - api.access - INFO - Response: 200 in 4.3227s
INFO:api.access:Response: 200 in 4.3227s
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
INFO:     127.0.0.1:60371 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:40:35,922 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:40:35,922 - api.access - INFO - Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight on 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
2026-02-02 15:40:40,145 - api.access - INFO - Response: 200 in 4.2234s
INFO:api.access:Response: 200 in 4.2234s
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
INFO:     127.0.0.1:60398 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:40:48,228 - api.access - INFO - Response: 500 in 139.8863s
INFO:api.access:Response: 500 in 139.8863s
Error in agent query [request_id=135796ee-e55e-4460-a87d-26bdd3b89e9a]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:60270 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 15:40:48,255 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 15:40:48,256 - api.access - INFO - Body: {
  "query": "Patient 179713d4-6c3d-4397-81f4-687dc9d7e609 is taking Warfarin. Can they also take Aspirin for a headache?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-3"
}
INFO:api.access:Body: {
  "query": "Patient 179713d4-6c3d-4397-81f4-687dc9d7e609 is taking Warfarin. Can they also take Aspirin for a headache?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-3"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I46.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://rxnav.nlm.nih.gov/REST/rxcui.json?name=Aspirin "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:40:56,571 - api.access - INFO - Response: 500 in 8.3157s
INFO:api.access:Response: 500 in 8.3157s
Error in agent query [request_id=f34f6e35-6c64-40cb-98d3-46661b90d0ab]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 340, in _validator_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iter})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
During task with name 'validator' and id '13d44924-f245-3861-7d68-b36758b75b67'

INFO:     127.0.0.1:60408 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 15:40:56,592 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 15:40:56,592 - api.access - INFO - Body: {
  "query": "What is the latest creatinine lab result for patient 179713d4-6c3d-4397-81f4-687dc9d7e609?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-4"
}
INFO:api.access:Body: {
  "query": "What is the latest creatinine lab result for patient 179713d4-6c3d-4397-81f4-687dc9d7e609?",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609",
  "session_id": "e2e-test-4"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:40:58,537 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 15:40:58,538 - api.access - INFO - Body: {
  "query": "latest creatinine lab result for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "latest creatinine lab result for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
Warning: Only found 7/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.46it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.45it/s]
2026-02-02 15:41:02,618 - api.access - INFO - Response: 200 in 4.0807s
INFO:api.access:Response: 200 in 4.0807s
INFO:     127.0.0.1:60422 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 15:41:13,168 - api.access - INFO - Response: 200 in 16.5758s
INFO:api.access:Response: 200 in 16.5758s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:60420 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:17:32,526 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:17:32,572 - api.access - INFO - Response: 200 in 0.0567s
INFO:api.access:Response: 200 in 0.0567s
INFO:     127.0.0.1:63116 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:17:32,585 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:17:32,587 - api.access - INFO - Body: {
  "query": "What active conditions does patient 179713d4-6c3d-4397-81f4-687dc9d7e609 have?",
  "session_id": "golden-candidate-0",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
}
INFO:api.access:Body: {
  "query": "What active conditions does patient 179713d4-6c3d-4397-81f4-687dc9d7e609 have?",
  "session_id": "golden-candidate-0",
  "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:17:39,164 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:17:39,164 - api.access - INFO - Body: {
  "query": "active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "active conditions for patient 179713d4-6c3d-4397-81f4-687dc9d7e609",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "179713d4-6c3d-4397-81f4-687dc9d7e609"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-625' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-682' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-820' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 16:17:46,417 - api.access - INFO - Response: 200 in 7.2534s
INFO:api.access:Response: 200 in 7.2534s
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=179713d4-6c3d-4397-81f4-687dc9d7e609)
INFO:     127.0.0.1:63127 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:00,157 - api.access - INFO - Response: 200 in 27.5714s
INFO:api.access:Response: 200 in 27.5714s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63118 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:18:00,189 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:18:00,190 - api.access - INFO - Response: 200 in 0.0014s
INFO:api.access:Response: 200 in 0.0014s
INFO:     127.0.0.1:63193 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:18:00,204 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:18:00,204 - api.access - INFO - Body: {
  "query": "List all medications prescribed to the patient.",
  "session_id": "golden-candidate-1",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "List all medications prescribed to the patient.",
  "session_id": "golden-candidate-1",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:00,786 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:18:00,787 - api.access - INFO - Body: {
  "query": "medications prescribed to patient",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "medications prescribed to patient",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.49it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.90it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.54it/s]
2026-02-02 16:18:05,923 - api.access - INFO - Response: 200 in 5.1364s
INFO:api.access:Response: 200 in 5.1364s
INFO:     127.0.0.1:63199 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:24,350 - api.access - INFO - Response: 200 in 24.1463s
INFO:api.access:Response: 200 in 24.1463s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63195 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:18:24,369 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:18:24,369 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:63295 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:18:24,378 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:18:24,378 - api.access - INFO - Body: {
  "query": "What was the patient's body weight on 2010-12-07?",
  "session_id": "golden-candidate-2",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What was the patient's body weight on 2010-12-07?",
  "session_id": "golden-candidate-2",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:33,529 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:18:33,530 - api.access - INFO - Body: {
  "query": "Observation effectiveDateTime 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation effectiveDateTime 2010-12-07",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=0000d346-2e09-428f-b37b-b9d5182e313f)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.33it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.31it/s]
2026-02-02 16:18:39,170 - api.access - INFO - Response: 200 in 5.6409s
INFO:api.access:Response: 200 in 5.6409s
INFO:     127.0.0.1:63310 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:55,907 - api.access - INFO - Response: 200 in 31.5289s
INFO:api.access:Response: 200 in 31.5289s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63297 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:18:55,931 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:18:55,931 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:63356 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:18:55,939 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:18:55,939 - api.access - INFO - Body: {
  "query": "Does the patient have any recorded immunizations? If so, which ones?",
  "session_id": "golden-candidate-3",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "Does the patient have any recorded immunizations? If so, which ones?",
  "session_id": "golden-candidate-3",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:18:56,486 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:18:56,486 - api.access - INFO - Body: {
  "query": "immunization",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
INFO:api.access:Body: {
  "query": "immunization",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.26it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.25it/s]
2026-02-02 16:19:00,079 - api.access - INFO - Response: 200 in 3.5934s
INFO:api.access:Response: 200 in 3.5934s
INFO:     127.0.0.1:63361 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=V05.0 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:05,710 - api.access - INFO - Response: 200 in 9.7709s
INFO:api.access:Response: 200 in 9.7709s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63358 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:19:05,724 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:19:05,725 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:63373 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:19:05,734 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:19:05,735 - api.access - INFO - Body: {
  "query": "What was the result of the patient's eGFR test on 2010-12-07?",
  "session_id": "golden-candidate-4",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What was the result of the patient's eGFR test on 2010-12-07?",
  "session_id": "golden-candidate-4",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1204' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:06,536 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:19:06,537 - api.access - INFO - Body: {
  "query": "eGFR test result 2010-12-07",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "eGFR test result 2010-12-07",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 16:19:11,129 - api.access - INFO - Response: 200 in 4.5929s
INFO:api.access:Response: 200 in 4.5929s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:63377 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z99.2&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:16,982 - api.access - INFO - Response: 200 in 11.2476s
INFO:api.access:Response: 200 in 11.2476s
INFO:     127.0.0.1:63375 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:19:16,999 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:19:17,000 - api.access - INFO - Response: 200 in 0.0014s
INFO:api.access:Response: 200 in 0.0014s
INFO:     127.0.0.1:63386 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:19:17,007 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:19:17,007 - api.access - INFO - Body: {
  "query": "Has the patient undergone any procedures? List them.",
  "session_id": "golden-candidate-5",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "Has the patient undergone any procedures? List them.",
  "session_id": "golden-candidate-5",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:17,499 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:19:17,500 - api.access - INFO - Body: {
  "query": "procedures",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
INFO:api.access:Body: {
  "query": "procedures",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.02it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.02it/s]
2026-02-02 16:19:20,732 - api.access - INFO - Response: 200 in 3.2326s
INFO:api.access:Response: 200 in 3.2326s
INFO:     127.0.0.1:63390 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1343' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=85548006&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:30,129 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:19:30,130 - api.access - INFO - Body: {
  "query": "Hypertensive heart disease AND Essential (primary) hypertension",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Hypertensive heart disease AND Essential (primary) hypertension",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-897' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-975' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1129' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1274' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=0000d346-2e09-428f-b37b-b9d5182e313f)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 28.87it/s]
2026-02-02 16:19:34,483 - api.access - INFO - Response: 200 in 4.3539s
INFO:api.access:Response: 200 in 4.3539s
INFO:     127.0.0.1:63406 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:45,105 - api.access - INFO - Response: 200 in 28.0973s
INFO:api.access:Response: 200 in 28.0973s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63388 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:19:45,128 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:19:45,129 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:63429 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:19:45,139 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:19:45,139 - api.access - INFO - Body: {
  "query": "What is the patient's Body Mass Index (BMI) as of December 2010?",
  "session_id": "golden-candidate-6",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What is the patient's Body Mass Index (BMI) as of December 2010?",
  "session_id": "golden-candidate-6",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=39156-5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:58,712 - api.access - INFO - Response: 500 in 13.5733s
INFO:api.access:Response: 500 in 13.5733s
Error in agent query [request_id=13295cfc-f671-4b2c-8e7e-3e84342c5aa0]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 340, in _validator_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iter})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
During task with name 'validator' and id 'ddf4ad09-3191-0fde-58a1-609011807964'

INFO:     127.0.0.1:63431 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 16:19:58,724 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:19:58,725 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:63447 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:19:58,762 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:19:58,763 - api.access - INFO - Body: {
  "query": "What was the reason for the encounter on 2010-12-08?",
  "session_id": "golden-candidate-7",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What was the reason for the encounter on 2010-12-08?",
  "session_id": "golden-candidate-7",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:19:59,299 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:19:59,299 - api.access - INFO - Body: {
  "query": "reason for encounter on 2010-12-08",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": null
}
INFO:api.access:Body: {
  "query": "reason for encounter on 2010-12-08",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": null
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.46it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.46it/s]
2026-02-02 16:20:02,390 - api.access - INFO - Response: 200 in 3.0908s
INFO:api.access:Response: 200 in 3.0908s
INFO:     127.0.0.1:63451 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=C34&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1659' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:20:09,015 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:20:09,015 - api.access - INFO - Body: {
  "query": "suspected lung cancer",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "suspected lung cancer",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 43.27it/s]
2026-02-02 16:20:13,405 - api.access - INFO - Response: 200 in 4.3907s
INFO:api.access:Response: 200 in 4.3907s
INFO:     127.0.0.1:63466 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z55&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S28.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:20:35,685 - api.access - INFO - Response: 200 in 36.9224s
INFO:api.access:Response: 200 in 36.9224s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63449 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:20:35,707 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:20:35,707 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:63496 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:20:35,715 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:20:35,715 - api.access - INFO - Body: {
  "query": "What is the patient's Total Cholesterol level?",
  "session_id": "golden-candidate-8",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What is the patient's Total Cholesterol level?",
  "session_id": "golden-candidate-8",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:20:45,379 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:20:45,379 - api.access - INFO - Body: {
  "query": "Observation/obs-total-cholesterol-2023-001",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation/obs-total-cholesterol-2023-001",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
  },
  "include_full_json": true
}
Warning: Only found 3/50 results after filtering from 5000 candidates (patient_id=0000d346-2e09-428f-b37b-b9d5182e313f)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 14.03it/s]
2026-02-02 16:20:49,403 - api.access - INFO - Response: 200 in 4.0242s
INFO:api.access:Response: 200 in 4.0242s
INFO:     127.0.0.1:63505 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:21:00,301 - api.access - INFO - Response: 200 in 24.5857s
INFO:api.access:Response: 200 in 24.5857s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63498 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:21:00,454 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:21:00,468 - api.access - INFO - Response: 200 in 0.0153s
INFO:api.access:Response: 200 in 0.0153s
INFO:     127.0.0.1:63526 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:21:00,488 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:21:00,488 - api.access - INFO - Body: {
  "query": "Identify any vital signs recorded for this patient.",
  "session_id": "golden-candidate-9",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "Identify any vital signs recorded for this patient.",
  "session_id": "golden-candidate-9",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:21:01,300 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:21:01,300 - api.access - INFO - Body: {
  "query": "vital signs",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "vital signs",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1438' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1714' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1907' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 10.11it/s]
2026-02-02 16:21:05,450 - api.access - INFO - Response: 200 in 4.1499s
INFO:api.access:Response: 200 in 4.1499s
INFO:     127.0.0.1:63531 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=29463-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:21:13,096 - api.access - INFO - Response: 200 in 12.6086s
INFO:api.access:Response: 200 in 12.6086s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63528 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:22:09,550 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:22:09,553 - api.access - INFO - Response: 200 in 0.0029s
INFO:api.access:Response: 200 in 0.0029s
INFO:     127.0.0.1:63619 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:22:09,563 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:22:09,563 - api.access - INFO - Body: {
  "query": "What is the patient's Body Mass Index (BMI) as of December 2010?",
  "session_id": "golden-retry-6",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:api.access:Body: {
  "query": "What is the patient's Body Mass Index (BMI) as of December 2010?",
  "session_id": "golden-retry-6",
  "patient_id": "0000d346-2e09-428f-b37b-b9d5182e313f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=39156-5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:22:22,970 - api.access - INFO - Response: 500 in 13.4069s
INFO:api.access:Response: 500 in 13.4069s
Error in agent query [request_id=ca9fce92-5d1e-4168-99e9-f25354f0d684]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 340, in _validator_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iter})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
During task with name 'validator' and id '5b9b373e-18f5-f1d1-ffbe-9c31527ae3c3'

INFO:     127.0.0.1:63621 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 16:23:49,127 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:23:49,128 - api.access - INFO - Response: 200 in 0.0016s
INFO:api.access:Response: 200 in 0.0016s
INFO:     127.0.0.1:63759 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:23:49,135 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:23:49,135 - api.access - INFO - Body: {
  "query": "Has patient d930e322-8c86-4c17-8ce8-217cb252e2e4 undergone any procedures? List them.",
  "session_id": "golden-run-19-0",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:api.access:Body: {
  "query": "Has patient d930e322-8c86-4c17-8ce8-217cb252e2e4 undergone any procedures? List them.",
  "session_id": "golden-run-19-0",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:23:50,351 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:23:50,351 - api.access - INFO - Body: {
  "query": "procedures for patient d930e322-8c86-4c17-8ce8-217cb252e2e4",
  "k_retrieve": 10,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
  }
}
INFO:api.access:Body: {
  "query": "procedures for patient d930e322-8c86-4c17-8ce8-217cb252e2e4",
  "k_retrieve": 10,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
  }
}
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=d930e322-8c86-4c17-8ce8-217cb252e2e4)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 19.03it/s]
2026-02-02 16:23:55,871 - api.access - INFO - Response: 200 in 5.5202s
INFO:api.access:Response: 200 in 5.5202s
INFO:     127.0.0.1:63765 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:24:03,920 - api.access - INFO - Response: 200 in 14.7854s
INFO:api.access:Response: 200 in 14.7854s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63761 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:24:03,932 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:24:03,932 - api.access - INFO - Response: 200 in 0.0008s
INFO:api.access:Response: 200 in 0.0008s
INFO:     127.0.0.1:63795 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:24:03,942 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:24:03,943 - api.access - INFO - Body: {
  "query": "What is patient 3f89ff20-09aa-40e7-a359-389863c7e574's blood pressure history?",
  "session_id": "golden-run-19-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "What is patient 3f89ff20-09aa-40e7-a359-389863c7e574's blood pressure history?",
  "session_id": "golden-run-19-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:24:15,520 - api.access - INFO - Response: 200 in 11.5776s
INFO:api.access:Response: 200 in 11.5776s
INFO:     127.0.0.1:63797 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:24:15,537 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:24:15,537 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:63809 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:24:15,548 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:24:15,548 - api.access - INFO - Body: {
  "query": "List all encounters for patient 3e80196f-06df-4568-a5e5-480b742b8639 in chronological order.",
  "session_id": "golden-run-19-2",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:api.access:Body: {
  "query": "List all encounters for patient 3e80196f-06df-4568-a5e5-480b742b8639 in chronological order.",
  "session_id": "golden-run-19-2",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:24:27,974 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:24:27,974 - api.access - INFO - Body: {
  "query": "FHIR resources in output",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "FHIR resources in output",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:24:33,085 - api.access - INFO - Response: 200 in 5.1114s
INFO:api.access:Response: 200 in 5.1114s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:63819 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:24:40,623 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:24:40,623 - api.access - INFO - Body: {
  "query": "Encounters",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounters",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-1980' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2194' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2369' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 19/50 results after filtering from 5000 candidates (patient_id=3e80196f-06df-4568-a5e5-480b742b8639)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.59it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  3.01it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.66it/s]
2026-02-02 16:24:46,827 - api.access - INFO - Response: 200 in 6.2037s
INFO:api.access:Response: 200 in 6.2037s
INFO:     127.0.0.1:63859 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J02.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:24:58,496 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:24:58,496 - api.access - INFO - Body: {
  "query": "urn:uuid:3e80196f-06df-4568-a5e5-480b742b8639",
  "k_retrieve": 20,
  "k_return": 1,
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "urn:uuid:3e80196f-06df-4568-a5e5-480b742b8639",
  "k_retrieve": 20,
  "k_return": 1,
  "include_full_json": true
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.93it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.93it/s]
2026-02-02 16:25:02,010 - api.access - INFO - Response: 200 in 3.5141s
INFO:api.access:Response: 200 in 3.5141s
INFO:     127.0.0.1:63913 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2483' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:25:19,364 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:25:19,364 - api.access - INFO - Body: {
  "query": "patient_id = 3e80196f-06df-4568-a5e5-480b742b8639",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "patient_id = 3e80196f-06df-4568-a5e5-480b742b8639",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
Warning: Only found 12/50 results after filtering from 5000 candidates (patient_id=3e80196f-06df-4568-a5e5-480b742b8639)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.02it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.02it/s]
2026-02-02 16:25:23,124 - api.access - INFO - Response: 200 in 3.7602s
INFO:api.access:Response: 200 in 3.7602s
INFO:     127.0.0.1:63926 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Acute+viral+pharyngitis+%28disorder%29&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J02.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:25:55,115 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:25:55,115 - api.access - INFO - Body: {
  "query": "encounter",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "encounter",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.21it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.21it/s]
2026-02-02 16:25:59,596 - api.access - INFO - Response: 200 in 4.4808s
INFO:api.access:Response: 200 in 4.4808s
INFO:     127.0.0.1:63972 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:26:03,451 - api.access - INFO - Response: 500 in 107.9025s
INFO:api.access:Response: 500 in 107.9025s
Error in agent query [request_id=324fbf29-05df-4578-9912-7bafb6a2ebb4]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:63811 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 16:26:03,464 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:26:03,464 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:63993 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:26:03,476 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:26:03,476 - api.access - INFO - Body: {
  "query": "What lab results are on file for patient c19e653d-f0d3-4a08-817a-ad0da990a288?",
  "session_id": "golden-run-19-3",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:api.access:Body: {
  "query": "What lab results are on file for patient c19e653d-f0d3-4a08-817a-ad0da990a288?",
  "session_id": "golden-run-19-3",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:26:04,337 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:26:04,337 - api.access - INFO - Body: {
  "query": "lab results for patient c19e653d-f0d3-4a08-817a-ad0da990a288",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lab results for patient c19e653d-f0d3-4a08-817a-ad0da990a288",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2422' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2542' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2681' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 27/50 results after filtering from 5000 candidates (patient_id=c19e653d-f0d3-4a08-817a-ad0da990a288)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.71it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
2026-02-02 16:26:09,197 - api.access - INFO - Response: 200 in 4.8602s
INFO:api.access:Response: 200 in 4.8602s
INFO:     127.0.0.1:64002 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J06.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:26:24,734 - api.access - INFO - Response: 200 in 21.2576s
INFO:api.access:Response: 200 in 21.2576s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:63995 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:26:24,762 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:26:24,763 - api.access - INFO - Response: 200 in 0.0007s
INFO:api.access:Response: 200 in 0.0007s
INFO:     127.0.0.1:64034 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:26:24,772 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:26:24,772 - api.access - INFO - Body: {
  "query": "Calculate the BMI for patient e149aa89-cc9e-483e-b78b-00f0433072e0 using their most recent height and weight.",
  "session_id": "golden-run-19-4",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:api.access:Body: {
  "query": "Calculate the BMI for patient e149aa89-cc9e-483e-b78b-00f0433072e0 using their most recent height and weight.",
  "session_id": "golden-run-19-4",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:26:30,878 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:26:30,878 - api.access - INFO - Body: {
  "query": "BMI calculation",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "BMI calculation",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 33.15it/s]
2026-02-02 16:26:34,831 - api.access - INFO - Response: 200 in 3.9533s
INFO:api.access:Response: 200 in 3.9533s
INFO:     127.0.0.1:64085 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=39156-5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8302-2 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=29463-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:26:50,934 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:26:50,934 - api.access - INFO - Body: {
  "query": "39156-5 OR 8302-2 OR 29463-7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "39156-5 OR 8302-2 OR 29463-7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:26:55,096 - api.access - INFO - Response: 200 in 4.1620s
INFO:api.access:Response: 200 in 4.1620s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64119 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8302-2 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=29463-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=39156-5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:27:01,422 - api.access - INFO - Response: 200 in 36.6501s
INFO:api.access:Response: 200 in 36.6501s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64036 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:27:01,438 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:27:01,438 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:64139 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:27:01,446 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:27:01,446 - api.access - INFO - Body: {
  "query": "What conditions was patient 5dcb9365-483d-48d7-bc62-816221b3f8b7 diagnosed with in the past 2 years?",
  "session_id": "golden-run-19-5",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:api.access:Body: {
  "query": "What conditions was patient 5dcb9365-483d-48d7-bc62-816221b3f8b7 diagnosed with in the past 2 years?",
  "session_id": "golden-run-19-5",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:27:02,422 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:27:02,422 - api.access - INFO - Body: {
  "query": "diagnosis of patient 5dcb9365-483d-48d7-bc62-816221b3f8b7 in past 2 years",
  "k_retrieve": 10,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  }
}
INFO:api.access:Body: {
  "query": "diagnosis of patient 5dcb9365-483d-48d7-bc62-816221b3f8b7 in past 2 years",
  "k_retrieve": 10,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  }
}
Warning: Only found 7/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  8.13it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  8.13it/s]
2026-02-02 16:27:06,148 - api.access - INFO - Response: 200 in 3.7265s
INFO:api.access:Response: 200 in 3.7265s
INFO:     127.0.0.1:64146 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=diabetes&maxList=5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E23.2&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=N25.1&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=P70.2&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=O24.92&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z83.3&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Diabetes&maxList=5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E23.2&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=N25.1&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=P70.2&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=O24.92&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z83.3&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:27:44,327 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:27:44,328 - api.access - INFO - Body: {
  "query": "conditions diagnosed in the past 2 years",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "conditions diagnosed in the past 2 years",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2727' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2841' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-2925' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3008' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 8/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.77it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.76it/s]
2026-02-02 16:27:49,466 - api.access - INFO - Response: 200 in 5.1391s
INFO:api.access:Response: 200 in 5.1391s
INFO:     127.0.0.1:64186 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:27:58,910 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:27:58,910 - api.access - INFO - Body: {
  "query": "diabetes diagnosis",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  }
}
INFO:api.access:Body: {
  "query": "diabetes diagnosis",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  }
}
Warning: Only found 30/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.63it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.63it/s]
2026-02-02 16:28:03,032 - api.access - INFO - Response: 200 in 4.1217s
INFO:api.access:Response: 200 in 4.1217s
INFO:     127.0.0.1:64223 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:28:12,404 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:28:12,404 - api.access - INFO - Body: {
  "query": "Condition/02319a24-653b-44ab-9258-b775b17d17e4",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Condition/02319a24-653b-44ab-9258-b775b17d17e4",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 48.25it/s]
2026-02-02 16:28:16,817 - api.access - INFO - Response: 200 in 4.4134s
INFO:api.access:Response: 200 in 4.4134s
INFO:     127.0.0.1:64246 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:28:29,160 - api.access - INFO - Response: 200 in 87.7135s
INFO:api.access:Response: 200 in 87.7135s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64141 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:28:29,179 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:28:29,180 - api.access - INFO - Response: 200 in 0.0010s
INFO:api.access:Response: 200 in 0.0010s
INFO:     127.0.0.1:64263 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:28:29,188 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:28:29,188 - api.access - INFO - Body: {
  "query": "Compare patient 3f89ff20-09aa-40e7-a359-389863c7e574's cholesterol levels across multiple visits.",
  "session_id": "golden-run-19-6",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "Compare patient 3f89ff20-09aa-40e7-a359-389863c7e574's cholesterol levels across multiple visits.",
  "session_id": "golden-run-19-6",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:28:40,014 - api.access - INFO - Response: 200 in 10.8258s
INFO:api.access:Response: 200 in 10.8258s
INFO:     127.0.0.1:64265 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:28:40,032 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:28:40,032 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:64278 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:28:40,042 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:28:40,042 - api.access - INFO - Body: {
  "query": "What is patient c19e653d-f0d3-4a08-817a-ad0da990a288's blood pressure history?",
  "session_id": "golden-run-19-7",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:api.access:Body: {
  "query": "What is patient c19e653d-f0d3-4a08-817a-ad0da990a288's blood pressure history?",
  "session_id": "golden-run-19-7",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:28:55,709 - api.access - INFO - Response: 200 in 15.6672s
INFO:api.access:Response: 200 in 15.6672s
INFO:     127.0.0.1:64280 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:28:55,736 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:28:55,736 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:64315 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:28:55,745 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:28:55,745 - api.access - INFO - Body: {
  "query": "List all encounters for patient 3f89ff20-09aa-40e7-a359-389863c7e574 in chronological order.",
  "session_id": "golden-run-19-8",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "List all encounters for patient 3f89ff20-09aa-40e7-a359-389863c7e574 in chronological order.",
  "session_id": "golden-run-19-8",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:29:18,278 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:29:18,278 - api.access - INFO - Body: {
  "query": "patient_id:3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "patient_id:3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3238' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3297' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3353' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 27.99it/s]
2026-02-02 16:29:22,672 - api.access - INFO - Response: 200 in 4.3942s
INFO:api.access:Response: 200 in 4.3942s
INFO:     127.0.0.1:64339 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:29:32,487 - api.access - INFO - Response: 200 in 36.7424s
INFO:api.access:Response: 200 in 36.7424s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64317 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:29:32,513 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:29:32,513 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:64352 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:29:32,526 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:29:32,527 - api.access - INFO - Body: {
  "query": "Summarize the complete medical history for patient d930e322-8c86-4c17-8ce8-217cb252e2e4.",
  "session_id": "golden-run-19-9",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:api.access:Body: {
  "query": "Summarize the complete medical history for patient d930e322-8c86-4c17-8ce8-217cb252e2e4.",
  "session_id": "golden-run-19-9",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:29:41,590 - api.access - INFO - Response: 200 in 9.0643s
INFO:api.access:Response: 200 in 9.0643s
INFO:     127.0.0.1:64354 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:29:41,609 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:29:41,610 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:64362 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:29:41,618 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:29:41,619 - api.access - INFO - Body: {
  "query": "What follow-up care recommendations exist for patient 723d6d77-8a55-424b-b4fc-99e3b48e7e73?",
  "session_id": "golden-run-19-10",
  "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
}
INFO:api.access:Body: {
  "query": "What follow-up care recommendations exist for patient 723d6d77-8a55-424b-b4fc-99e3b48e7e73?",
  "session_id": "golden-run-19-10",
  "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:29:42,321 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:29:42,321 - api.access - INFO - Body: {
  "query": "follow-up care recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "follow-up care recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 12.57it/s]
2026-02-02 16:29:47,584 - api.access - INFO - Response: 200 in 5.2630s
INFO:api.access:Response: 200 in 5.2630s
INFO:     127.0.0.1:64367 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J40&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:30:14,437 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,438 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,439 - api.access - INFO - Body: {
  "query": "Patient/urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Patient/urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,439 - api.access - INFO - Body: {
  "query": "Encounter/urn:uuid:90a62995-8488-4e71-a74c-86dff68a78e4",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter/urn:uuid:90a62995-8488-4e71-a74c-86dff68a78e4",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,439 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,439 - api.access - INFO - Body: {
  "query": "Patient/urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Patient/urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,440 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,440 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,448 - api.access - INFO - Body: {
  "query": "Encounter/urn:uuid:90a62995-8488-4e71-a74c-86dff68a78e4",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter/urn:uuid:90a62995-8488-4e71-a74c-86dff68a78e4",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,448 - api.access - INFO - Body: {
  "query": "Encounter/urn:uuid:f545249a-52d6-4cbe-8abf-a69a960d7208",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter/urn:uuid:f545249a-52d6-4cbe-8abf-a69a960d7208",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,453 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,454 - api.access - INFO - Body: {
  "query": "Observation/urn:uuid:12345678-1234-5678-9012-345678901234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation/urn:uuid:12345678-1234-5678-9012-345678901234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,454 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,455 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:14,455 - api.access - INFO - Body: {
  "query": "Condition/urn:uuid:56789012-3456-7890-1234-567890123456",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Condition/urn:uuid:56789012-3456-7890-1234-567890123456",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
2026-02-02 16:30:14,455 - api.access - INFO - Body: {
  "query": "MedicationRequest/urn:uuid:90123456-7890-1234-5678-901234567890",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "MedicationRequest/urn:uuid:90123456-7890-1234-5678-901234567890",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
Warning: Only found 11/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.92it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.92it/s]
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3632' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3766' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3953' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 47.96it/s]
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 11.70it/s]
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 11.68it/s]
2026-02-02 16:30:28,843 - api.access - INFO - Response: 200 in 14.4060s
INFO:api.access:Response: 200 in 14.4060s
INFO:     127.0.0.1:64411 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
2026-02-02 16:30:28,843 - api.access - INFO - Response: 200 in 14.4038s
INFO:api.access:Response: 200 in 14.4038s
INFO:     127.0.0.1:64418 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
2026-02-02 16:30:28,844 - api.access - INFO - Response: 200 in 14.3902s
INFO:api.access:Response: 200 in 14.3902s
INFO:     127.0.0.1:64421 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
2026-02-02 16:30:28,876 - api.access - INFO - Response: 200 in 14.4377s
INFO:api.access:Response: 200 in 14.4377s
INFO:     127.0.0.1:64412 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3954' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3956' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3960' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Warning: Only found 9/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.21it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.21it/s]
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 29.82it/s]
2026-02-02 16:30:34,601 - api.access - INFO - Response: 200 in 20.1613s
INFO:api.access:Response: 200 in 20.1613s
INFO:     127.0.0.1:64417 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
2026-02-02 16:30:34,608 - api.access - INFO - Response: 200 in 20.1534s
INFO:api.access:Response: 200 in 20.1534s
INFO:     127.0.0.1:64423 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
2026-02-02 16:30:34,619 - api.access - INFO - Response: 200 in 20.1803s
INFO:api.access:Response: 200 in 20.1803s
INFO:     127.0.0.1:64413 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
2026-02-02 16:30:34,622 - api.access - INFO - Response: 200 in 20.1679s
INFO:api.access:Response: 200 in 20.1679s
INFO:     127.0.0.1:64422 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I20&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:30:47,386 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:30:47,386 - api.access - INFO - Body: {
  "query": "urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "urn:uuid:723d6d77-8a55-424b-b4fc-99e3b48e7e73",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.72it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.94it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.66it/s]
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4054' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3958' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3959' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3955' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-3957' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 16:30:53,393 - api.access - INFO - Response: 200 in 6.0076s
INFO:api.access:Response: 200 in 6.0076s
INFO:     127.0.0.1:64476 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I20&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I20&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:10,603 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:31:10,603 - api.access - INFO - Body: {
  "query": "What are the patient's current medications?",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "What are the patient's current medications?",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 27.85it/s]
2026-02-02 16:31:15,001 - api.access - INFO - Response: 200 in 4.3980s
INFO:api.access:Response: 200 in 4.3980s
INFO:     127.0.0.1:64501 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:25,043 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:31:25,043 - api.access - INFO - Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:31:29,090 - api.access - INFO - Response: 200 in 4.0467s
INFO:api.access:Response: 200 in 4.0467s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64511 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:35,419 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:31:35,420 - api.access - INFO - Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:31:39,737 - api.access - INFO - Response: 200 in 4.3172s
INFO:api.access:Response: 200 in 4.3172s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64523 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:45,762 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:31:45,762 - api.access - INFO - Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/12345",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4152' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4210' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4264' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 16/50 results after filtering from 5000 candidates (patient_id=723d6d77-8a55-424b-b4fc-99e3b48e7e73)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.44it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.44it/s]
2026-02-02 16:31:49,902 - api.access - INFO - Response: 200 in 4.1401s
INFO:api.access:Response: 200 in 4.1401s
INFO:     127.0.0.1:64541 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:54,860 - api.access - INFO - Response: 500 in 133.2419s
INFO:api.access:Response: 500 in 133.2419s
Error in agent query [request_id=6dc62bea-700f-4dfb-bd6f-f97edae53517]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:64364 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 16:31:54,879 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:31:54,879 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:64556 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:31:54,886 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:31:54,886 - api.access - INFO - Body: {
  "query": "What immunizations has patient 3f89ff20-09aa-40e7-a359-389863c7e574 received?",
  "session_id": "golden-run-19-11",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "What immunizations has patient 3f89ff20-09aa-40e7-a359-389863c7e574 received?",
  "session_id": "golden-run-19-11",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:31:55,747 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:31:55,747 - api.access - INFO - Body: {
  "query": "immunizations for patient 3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "immunizations for patient 3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 12.73it/s]
2026-02-02 16:31:59,481 - api.access - INFO - Response: 200 in 3.7345s
INFO:api.access:Response: 200 in 3.7345s
INFO:     127.0.0.1:64560 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B94.8&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:32:07,452 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:32:07,452 - api.access - INFO - Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:32:11,187 - api.access - INFO - Response: 200 in 3.7350s
INFO:api.access:Response: 200 in 3.7350s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64570 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z55&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:32:17,780 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:32:17,780 - api.access - INFO - Body: {
  "query": "Bundle/123",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/123",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4318' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4363' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4421' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 16:32:21,552 - api.access - INFO - Response: 200 in 3.7718s
INFO:api.access:Response: 200 in 3.7718s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64578 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B94.8&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:32:29,546 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:32:29,546 - api.access - INFO - Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 16:32:32,670 - api.access - INFO - Response: 200 in 3.1236s
INFO:api.access:Response: 200 in 3.1236s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:64586 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B94.8&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:32:38,309 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:32:38,309 - api.access - INFO - Body: {
  "query": "Vaccination",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Vaccination",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 60.61it/s]
2026-02-02 16:32:42,279 - api.access - INFO - Response: 200 in 3.9698s
INFO:api.access:Response: 200 in 3.9698s
INFO:     127.0.0.1:64596 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:32:50,474 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:32:50,474 - api.access - INFO - Body: {
  "query": "immunization",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "immunization",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4476' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4531' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4586' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 16.06it/s]
2026-02-02 16:32:54,366 - api.access - INFO - Response: 200 in 3.8920s
INFO:api.access:Response: 200 in 3.8920s
INFO:     127.0.0.1:64614 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B94.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:33:02,015 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:33:02,015 - api.access - INFO - Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
Warning: Only found 12/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.61it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.60it/s]
2026-02-02 16:33:05,500 - api.access - INFO - Response: 200 in 3.4845s
INFO:api.access:Response: 200 in 3.4845s
INFO:     127.0.0.1:64641 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B91&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:33:14,816 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:33:14,816 - api.access - INFO - Body: {
  "query": "Immunization",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Immunization",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
2026-02-02 16:33:18,199 - api.access - INFO - Response: 200 in 3.3822s
INFO:api.access:Response: 200 in 3.3822s
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
INFO:     127.0.0.1:64655 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:33:22,235 - api.access - INFO - Response: 500 in 87.3491s
INFO:api.access:Response: 500 in 87.3491s
Error in agent query [request_id=a04865de-11b7-4648-bf5c-653a9e255a99]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:64558 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 16:33:22,257 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:33:22,258 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:64663 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:33:22,265 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:33:22,265 - api.access - INFO - Body: {
  "query": "What is the trend in patient 72790c7f-7ee6-400f-aba9-b4bea77d929a's glucose levels over time?",
  "session_id": "golden-run-19-12",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:api.access:Body: {
  "query": "What is the trend in patient 72790c7f-7ee6-400f-aba9-b4bea77d929a's glucose levels over time?",
  "session_id": "golden-run-19-12",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Creatinine "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Sodium "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Creatinine&maxList=5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Sodium&maxList=5 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:33:52,347 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:33:52,347 - api.access - INFO - Body: {
  "query": "glucose level trend for patient 72790c7f-7ee6-400f-aba9-b4bea77d929a",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "glucose level trend for patient 72790c7f-7ee6-400f-aba9-b4bea77d929a",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4643' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4701' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4758' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 11/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.05it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.05it/s]
2026-02-02 16:34:01,243 - api.access - INFO - Response: 200 in 8.8963s
INFO:api.access:Response: 200 in 8.8963s
INFO:     127.0.0.1:64724 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:34:09,979 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:34:09,979 - api.access - INFO - Body: {
  "query": "Bundle/123",
  "k_retrieve": 48,
  "k_return": 12,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Bundle/123",
  "k_retrieve": 48,
  "k_return": 12,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
Warning: Only found 8/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.72it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  5.72it/s]
2026-02-02 16:34:16,454 - api.access - INFO - Response: 200 in 6.4748s
INFO:api.access:Response: 200 in 6.4748s
INFO:     127.0.0.1:64817 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:34:26,289 - api.access - INFO - Response: 200 in 64.0247s
INFO:api.access:Response: 200 in 64.0247s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64665 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:34:26,310 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:34:26,310 - api.access - INFO - Response: 200 in 0.0007s
INFO:api.access:Response: 200 in 0.0007s
INFO:     127.0.0.1:64852 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:34:26,318 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:34:26,318 - api.access - INFO - Body: {
  "query": "What is patient d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921's blood pressure history?",
  "session_id": "golden-run-19-13",
  "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
}
INFO:api.access:Body: {
  "query": "What is patient d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921's blood pressure history?",
  "session_id": "golden-run-19-13",
  "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:34:37,938 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:34:37,938 - api.access - INFO - Body: {
  "query": "patient_id=d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "patient_id=d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
  },
  "include_full_json": true
}
Warning: Only found 11/50 results after filtering from 5000 candidates (patient_id=d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.34it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.34it/s]
2026-02-02 16:34:45,427 - api.access - INFO - Response: 200 in 7.4894s
INFO:api.access:Response: 200 in 7.4894s
INFO:     127.0.0.1:64868 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:34:52,772 - api.access - INFO - Response: 200 in 26.4541s
INFO:api.access:Response: 200 in 26.4541s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64854 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:34:52,837 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:34:52,837 - api.access - INFO - Response: 200 in 0.0008s
INFO:api.access:Response: 200 in 0.0008s
INFO:     127.0.0.1:64898 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:34:52,846 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:34:52,846 - api.access - INFO - Body: {
  "query": "What is patient 3e80196f-06df-4568-a5e5-480b742b8639's blood pressure history?",
  "session_id": "golden-run-19-14",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:api.access:Body: {
  "query": "What is patient 3e80196f-06df-4568-a5e5-480b742b8639's blood pressure history?",
  "session_id": "golden-run-19-14",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:01,805 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:35:01,805 - api.access - INFO - Body: {
  "query": "blood pressure",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=3e80196f-06df-4568-a5e5-480b742b8639)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 13.15it/s]
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-4957' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5016' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5135' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5253' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 16:35:07,386 - api.access - INFO - Response: 200 in 5.5811s
INFO:api.access:Response: 200 in 5.5811s
INFO:     127.0.0.1:64919 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:16,372 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:35:16,372 - api.access - INFO - Body: {
  "query": "Observation",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  },
  "include_full_json": true
}
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=3e80196f-06df-4568-a5e5-480b742b8639)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.11it/s]Batches: 100%|██████████| 2/2 [00:01<00:00,  1.85it/s]Batches: 100%|██████████| 2/2 [00:01<00:00,  1.68it/s]
2026-02-02 16:35:22,293 - api.access - INFO - Response: 200 in 5.9211s
INFO:api.access:Response: 200 in 5.9211s
INFO:     127.0.0.1:64932 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:37,086 - api.access - INFO - Response: 200 in 44.2399s
INFO:api.access:Response: 200 in 44.2399s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64900 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:35:37,109 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:35:37,109 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:64953 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:35:37,117 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:35:37,118 - api.access - INFO - Body: {
  "query": "What diagnostic reports exist for patient 3e80196f-06df-4568-a5e5-480b742b8639?",
  "session_id": "golden-run-19-15",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:api.access:Body: {
  "query": "What diagnostic reports exist for patient 3e80196f-06df-4568-a5e5-480b742b8639?",
  "session_id": "golden-run-19-15",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:37,882 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:35:37,882 - api.access - INFO - Body: {
  "query": "diagnostic reports",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  }
}
INFO:api.access:Body: {
  "query": "diagnostic reports",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
  }
}
Warning: Only found 46/50 results after filtering from 5000 candidates (patient_id=3e80196f-06df-4568-a5e5-480b742b8639)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.71it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.71it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.49it/s]
2026-02-02 16:35:43,376 - api.access - INFO - Response: 200 in 5.4949s
INFO:api.access:Response: 200 in 5.4949s
INFO:     127.0.0.1:64958 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=F32&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:53,124 - api.access - INFO - Response: 200 in 16.0063s
INFO:api.access:Response: 200 in 16.0063s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64955 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:35:53,160 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:35:53,161 - api.access - INFO - Response: 200 in 0.0010s
INFO:api.access:Response: 200 in 0.0010s
INFO:     127.0.0.1:64976 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:35:53,170 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:35:53,170 - api.access - INFO - Body: {
  "query": "Has patient 3f89ff20-09aa-40e7-a359-389863c7e574 undergone any procedures? List them.",
  "session_id": "golden-run-19-16",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "Has patient 3f89ff20-09aa-40e7-a359-389863c7e574 undergone any procedures? List them.",
  "session_id": "golden-run-19-16",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:35:54,110 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 16:35:54,110 - api.access - INFO - Body: {
  "query": "procedures for patient 3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  }
}
INFO:api.access:Body: {
  "query": "procedures for patient 3f89ff20-09aa-40e7-a359-389863c7e574",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5311' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5390' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 47/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.12it/s]Batches: 100%|██████████| 2/2 [00:01<00:00,  2.13it/s]Batches: 100%|██████████| 2/2 [00:01<00:00,  1.87it/s]
2026-02-02 16:36:00,651 - api.access - INFO - Response: 200 in 6.5422s
INFO:api.access:Response: 200 in 6.5422s
INFO:     127.0.0.1:64983 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:36:12,328 - api.access - INFO - Response: 200 in 19.1577s
INFO:api.access:Response: 200 in 19.1577s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:64978 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:36:12,357 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:36:12,358 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:65003 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:36:12,365 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:36:12,365 - api.access - INFO - Body: {
  "query": "Compare patient 5dcb9365-483d-48d7-bc62-816221b3f8b7's cholesterol levels across multiple visits.",
  "session_id": "golden-run-19-17",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:api.access:Body: {
  "query": "Compare patient 5dcb9365-483d-48d7-bc62-816221b3f8b7's cholesterol levels across multiple visits.",
  "session_id": "golden-run-19-17",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:36:23,030 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:36:23,030 - api.access - INFO - Body: {
  "query": "Observation/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
Warning: Only found 25/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.15it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.14it/s]
2026-02-02 16:36:28,162 - api.access - INFO - Response: 200 in 5.1320s
INFO:api.access:Response: 200 in 5.1320s
INFO:     127.0.0.1:65012 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:36:35,426 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:36:35,426 - api.access - INFO - Body: {
  "query": "blood type",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood type",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 16:36:40,269 - api.access - INFO - Response: 200 in 4.8433s
INFO:api.access:Response: 200 in 4.8433s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:65029 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:36:47,563 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:36:47,563 - api.access - INFO - Body: {
  "query": "cholesterol levels comparison for patient 5dcb9365-483d-48d7-bc62-816221b3f8b7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "cholesterol levels comparison for patient 5dcb9365-483d-48d7-bc62-816221b3f8b7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
Warning: Only found 28/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.64it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
2026-02-02 16:36:53,453 - api.access - INFO - Response: 200 in 5.8908s
INFO:api.access:Response: 200 in 5.8908s
INFO:     127.0.0.1:65061 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:37:06,532 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:37:06,533 - api.access - INFO - Body: {
  "query": "patient 5dcb9365-483d-48d7-bc62-816221b3f8b7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "patient 5dcb9365-483d-48d7-bc62-816221b3f8b7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5465' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5586' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5645' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5700' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 4/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.12it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.11it/s]
2026-02-02 16:37:11,221 - api.access - INFO - Response: 200 in 4.6887s
INFO:api.access:Response: 200 in 4.6887s
INFO:     127.0.0.1:65090 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:37:20,025 - api.access - INFO - Response: 200 in 67.6603s
INFO:api.access:Response: 200 in 67.6603s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:65005 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 16:37:20,040 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 16:37:20,040 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:65101 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 16:37:20,046 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 16:37:20,046 - api.access - INFO - Body: {
  "query": "What follow-up care recommendations exist for patient 5dcb9365-483d-48d7-bc62-816221b3f8b7?",
  "session_id": "golden-run-19-18",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:api.access:Body: {
  "query": "What follow-up care recommendations exist for patient 5dcb9365-483d-48d7-bc62-816221b3f8b7?",
  "session_id": "golden-run-19-18",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:37:20,754 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 16:37:20,754 - api.access - INFO - Body: {
  "query": "follow-up care recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "follow-up care recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
  },
  "include_full_json": true
}
Warning: Only found 6/50 results after filtering from 5000 candidates (patient_id=5dcb9365-483d-48d7-bc62-816221b3f8b7)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 11.49it/s]
2026-02-02 16:37:25,634 - api.access - INFO - Response: 200 in 4.8797s
INFO:api.access:Response: 200 in 4.8797s
INFO:     127.0.0.1:65106 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 16:37:34,613 - api.access - INFO - Response: 200 in 14.5665s
INFO:api.access:Response: 200 in 14.5665s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:65103 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:30:00,781 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:30:00,785 - api.access - INFO - Response: 200 in 0.0042s
INFO:api.access:Response: 200 in 0.0042s
INFO:     127.0.0.1:51660 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:30:00,791 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:30:00,791 - api.access - INFO - Body: {
  "query": "What immunizations has this patient received?",
  "session_id": "comprehensive-eval-0",
  "patient_id": "1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f"
}
INFO:api.access:Body: {
  "query": "What immunizations has this patient received?",
  "session_id": "comprehensive-eval-0",
  "patient_id": "1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:07,438 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:30:07,438 - api.access - INFO - Body: {
  "query": "immunizations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "immunizations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.16it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.15it/s]
2026-02-02 17:30:13,964 - api.access - INFO - Response: 200 in 6.5262s
INFO:api.access:Response: 200 in 6.5262s
INFO:     127.0.0.1:51676 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:21,157 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:30:21,157 - api.access - INFO - Body: {
  "query": "influenza vaccination",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "influenza vaccination",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5760' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5836' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5910' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:30:25,290 - api.access - INFO - Response: 200 in 4.1329s
INFO:api.access:Response: 200 in 4.1329s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51695 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B05&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:34,944 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:30:34,944 - api.access - INFO - Body: {
  "query": "immunizations received by patient ID 1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "immunizations received by patient ID 1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f"
  },
  "include_full_json": true
}
Warning: Only found 6/50 results after filtering from 5000 candidates (patient_id=1b07b22f-2e2f-4dbc-ba4b-589590ab1f2f)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 10.06it/s]
2026-02-02 17:30:38,826 - api.access - INFO - Response: 200 in 3.8823s
INFO:api.access:Response: 200 in 3.8823s
INFO:     127.0.0.1:51706 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=V05.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:48,093 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:30:48,093 - api.access - INFO - Body: {
  "query": "influenza vaccine",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "influenza vaccine",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:30:51,659 - api.access - INFO - Response: 200 in 3.5664s
INFO:api.access:Response: 200 in 3.5664s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51720 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:55,970 - api.access - INFO - Response: 200 in 55.1796s
INFO:api.access:Response: 200 in 55.1796s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:51662 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:30:55,990 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:30:55,990 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:51735 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:30:55,998 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:30:55,998 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:56,679 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:30:56,679 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:30:56,682 - api.access - INFO - Response: 422 in 0.0036s
INFO:api.access:Response: 422 in 0.0036s
INFO:     127.0.0.1:51739 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:30:56,693 - api.access - INFO - Response: 500 in 0.6947s
INFO:api.access:Response: 500 in 0.6947s
Error in agent query [request_id=2e0ea3b0-205f-4394-b8b4-2ed855a0793b]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id 'ec6791ab-03c3-da62-932f-0a897334b692'
During task with name 'researcher' and id '5a2368d0-f051-b4b0-05fe-ba217501ddd2'

INFO:     127.0.0.1:51737 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:30:58,701 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:30:58,701 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:51746 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:30:58,707 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:30:58,708 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:30:59,473 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:30:59,473 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:30:59,473 - api.access - INFO - Response: 422 in 0.0010s
INFO:api.access:Response: 422 in 0.0010s
INFO:     127.0.0.1:51750 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:30:59,484 - api.access - INFO - Response: 500 in 0.7767s
INFO:api.access:Response: 500 in 0.7767s
Error in agent query [request_id=ec6aa2e0-c389-4d2b-b18d-8a56f574cec1]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '55c0ce99-54b6-ef1e-12ff-c6e2231c9ee3'
During task with name 'researcher' and id 'b4367078-76f4-e545-3d4e-7dc57429000f'

INFO:     127.0.0.1:51748 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:31:01,500 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:01,500 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:51752 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:01,511 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:01,511 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-1",
  "patient_id": "89af4442-bf60-4860-bc16-3e436713e308"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:02,267 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:02,267 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:31:02,268 - api.access - INFO - Response: 422 in 0.0010s
INFO:api.access:Response: 422 in 0.0010s
INFO:     127.0.0.1:51757 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:31:02,278 - api.access - INFO - Response: 500 in 0.7668s
INFO:api.access:Response: 500 in 0.7668s
Error in agent query [request_id=42a7862c-bd5a-43f0-91ca-76555a9d0756]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '8da488b3-0465-e426-4332-379e8d13736e'
During task with name 'researcher' and id '82bf0588-00b9-d032-6eed-87e94b0e5add'

INFO:     127.0.0.1:51754 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:31:02,287 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:02,287 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:51759 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:02,294 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:02,295 - api.access - INFO - Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-2",
  "patient_id": "95e16283-26d2-475d-8c0e-c4fc787a3b20"
}
INFO:api.access:Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-2",
  "patient_id": "95e16283-26d2-475d-8c0e-c4fc787a3b20"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:02,956 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:02,957 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-5965' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6021' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6079' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:31:06,507 - api.access - INFO - Response: 200 in 3.5502s
INFO:api.access:Response: 200 in 3.5502s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51763 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8462-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:12,497 - api.access - INFO - Response: 200 in 10.2027s
INFO:api.access:Response: 200 in 10.2027s
INFO:     127.0.0.1:51761 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:31:12,510 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:12,510 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:51773 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:12,519 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:12,519 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:13,200 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:13,201 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:31:13,201 - api.access - INFO - Response: 422 in 0.0008s
INFO:api.access:Response: 422 in 0.0008s
INFO:     127.0.0.1:51779 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:31:13,211 - api.access - INFO - Response: 500 in 0.6915s
INFO:api.access:Response: 500 in 0.6915s
Error in agent query [request_id=26e0a759-f979-4e24-afd1-7e5563a11d64]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '282e2037-590d-d1c3-2227-88b1a96883e8'
During task with name 'researcher' and id '314f75ec-e757-99a9-2d6d-6c19272e3bf3'

INFO:     127.0.0.1:51775 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:31:15,219 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:15,220 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:51781 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:15,226 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:15,226 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:15,976 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:15,976 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:31:15,977 - api.access - INFO - Response: 422 in 0.0009s
INFO:api.access:Response: 422 in 0.0009s
INFO:     127.0.0.1:51785 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:31:15,987 - api.access - INFO - Response: 500 in 0.7609s
INFO:api.access:Response: 500 in 0.7609s
Error in agent query [request_id=9437c8b3-7178-4154-ad6d-a27cb1d79512]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '6fc9a9f7-448e-681d-1e8b-1d4a2ad1332a'
During task with name 'researcher' and id '27704a24-7901-a123-a911-10ae8b562748'

INFO:     127.0.0.1:51783 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:31:18,013 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:18,013 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:51787 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:18,025 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:18,025 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-3",
  "patient_id": "53fcaff1-eb44-4257-819b-50b47f311edf"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:18,814 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:18,814 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:31:18,815 - api.access - INFO - Response: 422 in 0.0005s
INFO:api.access:Response: 422 in 0.0005s
INFO:     127.0.0.1:51791 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:31:18,821 - api.access - INFO - Response: 500 in 0.7967s
INFO:api.access:Response: 500 in 0.7967s
Error in agent query [request_id=c8038322-4c83-4c71-9b0e-c6ff3616c439]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id 'b5318810-3dbd-fb07-d8c9-7d4bc3024245'
During task with name 'researcher' and id '802a48de-5719-23fb-6f43-1db731df36c2'

INFO:     127.0.0.1:51789 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:31:18,828 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:18,829 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:51793 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:18,835 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:18,835 - api.access - INFO - Body: {
  "query": "What active medications is this patient currently taking?",
  "session_id": "comprehensive-eval-4",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:api.access:Body: {
  "query": "What active medications is this patient currently taking?",
  "session_id": "comprehensive-eval-4",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=L3891-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:25,871 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:25,871 - api.access - INFO - Body: {
  "query": "MedicationStatement/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "MedicationStatement/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 6/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.02it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  9.01it/s]
2026-02-02 17:31:29,560 - api.access - INFO - Response: 200 in 3.6889s
INFO:api.access:Response: 200 in 3.6889s
INFO:     127.0.0.1:51801 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:37,586 - api.access - INFO - Response: 200 in 18.7510s
INFO:api.access:Response: 200 in 18.7510s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:51795 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:31:37,599 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:37,600 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:51812 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:37,609 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:37,609 - api.access - INFO - Body: {
  "query": "What immunizations has this patient received?",
  "session_id": "comprehensive-eval-5",
  "patient_id": "9a49bf32-34f7-42e7-a33d-b1118080f3a5"
}
INFO:api.access:Body: {
  "query": "What immunizations has this patient received?",
  "session_id": "comprehensive-eval-5",
  "patient_id": "9a49bf32-34f7-42e7-a33d-b1118080f3a5"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:38,556 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:31:38,557 - api.access - INFO - Body: {
  "query": "immunizations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "immunizations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 17:31:41,745 - api.access - INFO - Response: 200 in 3.1887s
INFO:api.access:Response: 200 in 3.1887s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51817 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90670-2 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:47,061 - api.access - INFO - Response: 200 in 9.4522s
INFO:api.access:Response: 200 in 9.4522s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:51814 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:31:47,075 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:31:47,075 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:51825 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:31:47,084 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:31:47,084 - api.access - INFO - Body: {
  "query": "What care plans or treatment recommendations exist for this patient?",
  "session_id": "comprehensive-eval-6",
  "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
}
INFO:api.access:Body: {
  "query": "What care plans or treatment recommendations exist for this patient?",
  "session_id": "comprehensive-eval-6",
  "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:48,080 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:31:48,081 - api.access - INFO - Body: {
  "query": "care plans or treatment recommendations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "care plans or treatment recommendations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 17:31:51,409 - api.access - INFO - Response: 200 in 3.3286s
INFO:api.access:Response: 200 in 3.3286s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51831 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=12345-6 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:31:58,553 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:31:58,553 - api.access - INFO - Body: {
  "query": "patient/f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "patient/f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6235' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6431' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6504' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6574' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:32:01,849 - api.access - INFO - Response: 200 in 3.2959s
INFO:api.access:Response: 200 in 3.2959s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51848 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8462-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:32:08,374 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:32:08,375 - api.access - INFO - Body: {
  "query": "weight measurement",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight measurement",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:32:11,594 - api.access - INFO - Response: 200 in 3.2198s
INFO:api.access:Response: 200 in 3.2198s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51864 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z55&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:32:17,302 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:32:17,302 - api.access - INFO - Body: {
  "query": "weight measurement for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "weight measurement for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 35.89it/s]
2026-02-02 17:32:19,963 - api.access - INFO - Response: 200 in 2.6612s
INFO:api.access:Response: 200 in 2.6612s
INFO:     127.0.0.1:51872 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:32:29,594 - api.access - INFO - Response: 200 in 42.5103s
INFO:api.access:Response: 200 in 42.5103s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:51827 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:32:29,608 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:32:29,609 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:51883 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:32:29,618 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:32:29,618 - api.access - INFO - Body: {
  "query": "Are there any medication allergies documented for this patient?",
  "session_id": "comprehensive-eval-7",
  "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
}
INFO:api.access:Body: {
  "query": "Are there any medication allergies documented for this patient?",
  "session_id": "comprehensive-eval-7",
  "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=T46.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=T46.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z91.81&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:32:44,600 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:32:44,600 - api.access - INFO - Body: {
  "query": "medication allergy",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "medication allergy",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6629' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6684' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6739' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 3/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 44.67it/s]
2026-02-02 17:32:47,346 - api.access - INFO - Response: 200 in 2.7458s
INFO:api.access:Response: 200 in 2.7458s
INFO:     127.0.0.1:51896 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:32:55,669 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:32:55,669 - api.access - INFO - Body: {
  "query": "medication allergies",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "medication allergies",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
  },
  "include_full_json": true
}
Warning: Only found 3/50 results after filtering from 5000 candidates (patient_id=369a062e-604c-4bc8-a422-24c5c9260e4c)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 47.35it/s]
2026-02-02 17:32:58,065 - api.access - INFO - Response: 200 in 2.3956s
INFO:api.access:Response: 200 in 2.3956s
INFO:     127.0.0.1:51928 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:10,123 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:10,123 - api.access - INFO - Body: {
  "query": "medication allergy status",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "medication allergy status",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 73.79it/s]
2026-02-02 17:33:12,636 - api.access - INFO - Response: 200 in 2.5131s
INFO:api.access:Response: 200 in 2.5131s
INFO:     127.0.0.1:51940 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=hypertension&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:24,187 - api.access - INFO - Response: 500 in 54.5693s
INFO:api.access:Response: 500 in 54.5693s
Error in agent query [request_id=da739f8d-4a30-4782-b67a-4dadc6d54e6c]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:51885 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:33:26,217 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:26,218 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:51956 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:26,229 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:26,229 - api.access - INFO - Body: {
  "query": "Are there any medication allergies documented for this patient?",
  "session_id": "comprehensive-eval-7",
  "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
}
INFO:api.access:Body: {
  "query": "Are there any medication allergies documented for this patient?",
  "session_id": "comprehensive-eval-7",
  "patient_id": "369a062e-604c-4bc8-a422-24c5c9260e4c"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z91.81&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:30,119 - api.access - INFO - Response: 200 in 3.8902s
INFO:api.access:Response: 200 in 3.8902s
INFO:     127.0.0.1:51958 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:33:30,125 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:30,125 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:51967 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:30,130 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:30,131 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:30,811 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:30,811 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:33:30,812 - api.access - INFO - Response: 422 in 0.0013s
INFO:api.access:Response: 422 in 0.0013s
INFO:     127.0.0.1:51971 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:33:30,821 - api.access - INFO - Response: 500 in 0.6908s
INFO:api.access:Response: 500 in 0.6908s
Error in agent query [request_id=24676689-a254-4968-8b21-24caab70d837]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '588fc7f0-2f2e-6647-a7f0-bdc1e46a1065'
During task with name 'researcher' and id 'c901871f-adc5-7bdd-b019-d557da57f503'

INFO:     127.0.0.1:51969 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:33:32,840 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:32,840 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:51976 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:32,853 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:32,853 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:33,590 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:33,590 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:33:33,590 - api.access - INFO - Response: 422 in 0.0006s
INFO:api.access:Response: 422 in 0.0006s
INFO:     127.0.0.1:51980 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:33:33,595 - api.access - INFO - Response: 500 in 0.7424s
INFO:api.access:Response: 500 in 0.7424s
Error in agent query [request_id=646dd805-1168-411f-a509-c0bc030d80ac]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id 'b1248018-ba13-902d-c52c-75c9ff7ef939'
During task with name 'researcher' and id '82acafcd-7500-ba40-6620-afa9fa195692'

INFO:     127.0.0.1:51978 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:33:35,606 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:35,606 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:51982 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:35,614 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:35,615 - api.access - INFO - Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:api.access:Body: {
  "query": "Give a comprehensive overview of this patient's healthcare records.",
  "session_id": "comprehensive-eval-8",
  "patient_id": "cca48810-debd-4278-9128-2c118e8d732e"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:36,354 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:36,355 - api.access - INFO - Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:33:36,355 - api.access - INFO - Response: 422 in 0.0011s
INFO:api.access:Response: 422 in 0.0011s
INFO:     127.0.0.1:51986 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 17:33:36,365 - api.access - INFO - Response: 500 in 0.7502s
INFO:api.access:Response: 500 in 0.7502s
Error in agent query [request_id=7c1c4438-f3bc-4eb1-bd40-a734a367f5a1]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id 'ecbb3c93-5172-286b-ef90-888c8102f73a'
During task with name 'researcher' and id 'd45dc7e5-a16b-71a6-09a0-258ef2754c98'

INFO:     127.0.0.1:51984 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 17:33:36,373 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:36,374 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:51988 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:36,381 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:36,381 - api.access - INFO - Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-9",
  "patient_id": "566b9480-4f89-47d4-8fe3-ea275fc7b31f"
}
INFO:api.access:Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-9",
  "patient_id": "566b9480-4f89-47d4-8fe3-ea275fc7b31f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:37,002 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:37,002 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:33:38,962 - api.access - INFO - Response: 200 in 1.9594s
INFO:api.access:Response: 200 in 1.9594s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:51995 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:44,517 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:44,518 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6936' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-6993' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7089' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7315' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:33:46,588 - api.access - INFO - Response: 200 in 2.0710s
INFO:api.access:Response: 200 in 2.0710s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52004 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8462-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:51,810 - api.access - INFO - Response: 200 in 15.4290s
INFO:api.access:Response: 200 in 15.4290s
INFO:     127.0.0.1:51990 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:33:51,828 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:33:51,829 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:52020 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:33:51,837 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:33:51,837 - api.access - INFO - Body: {
  "query": "What lab results are most recent for this patient?",
  "session_id": "comprehensive-eval-10",
  "patient_id": "b198a9b0-98ad-44c7-8fab-a73ab44e1c3e"
}
INFO:api.access:Body: {
  "query": "What lab results are most recent for this patient?",
  "session_id": "comprehensive-eval-10",
  "patient_id": "b198a9b0-98ad-44c7-8fab-a73ab44e1c3e"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:33:52,558 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:33:52,558 - api.access - INFO - Body: {
  "query": "lab results",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lab results",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:33:54,504 - api.access - INFO - Response: 200 in 1.9459s
INFO:api.access:Response: 200 in 1.9459s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52025 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query= "HTTP/1.1 400 Bad Request"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:00,977 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:34:00,977 - api.access - INFO - Body: {
  "query": "lab results for patient b198a9b0-98ad-44c7-8fab-a73ab44e1c3e",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "b198a9b0-98ad-44c7-8fab-a73ab44e1c3e"
  }
}
INFO:api.access:Body: {
  "query": "lab results for patient b198a9b0-98ad-44c7-8fab-a73ab44e1c3e",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "b198a9b0-98ad-44c7-8fab-a73ab44e1c3e"
  }
}
2026-02-02 17:34:03,036 - api.access - INFO - Response: 200 in 2.0598s
INFO:api.access:Response: 200 in 2.0598s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=b198a9b0-98ad-44c7-8fab-a73ab44e1c3e)
INFO:     127.0.0.1:52041 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query= "HTTP/1.1 400 Bad Request"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:09,193 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:34:09,193 - api.access - INFO - Body: {
  "query": "lookup_loinc error in request",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lookup_loinc error in request",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7370' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7443' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7498' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:34:11,196 - api.access - INFO - Response: 200 in 2.0032s
INFO:api.access:Response: 200 in 2.0032s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52050 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query= "HTTP/1.1 400 Bad Request"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:18,333 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:34:18,334 - api.access - INFO - Body: {
  "query": "lab test results for patient with ID f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lab test results for patient with ID f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:34:20,261 - api.access - INFO - Response: 200 in 1.9272s
INFO:api.access:Response: 200 in 1.9272s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52062 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:26,354 - api.access - INFO - Response: 200 in 34.5168s
INFO:api.access:Response: 200 in 34.5168s
INFO:     127.0.0.1:52022 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:34:26,367 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:34:26,367 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:52071 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:34:26,376 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:34:26,377 - api.access - INFO - Body: {
  "query": "What are this patient's current active conditions?",
  "session_id": "comprehensive-eval-11",
  "patient_id": "c3a04059-3728-4f03-90e4-ee3677c36f66"
}
INFO:api.access:Body: {
  "query": "What are this patient's current active conditions?",
  "session_id": "comprehensive-eval-11",
  "patient_id": "c3a04059-3728-4f03-90e4-ee3677c36f66"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=active+condition&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:35,338 - api.access - INFO - Response: 200 in 8.9610s
INFO:api.access:Response: 200 in 8.9610s
INFO:     127.0.0.1:52073 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:34:35,352 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:34:35,352 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:52084 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:34:35,362 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:34:35,362 - api.access - INFO - Body: {
  "query": "Does this patient have any chronic conditions? If so, what are they?",
  "session_id": "comprehensive-eval-12",
  "patient_id": "c4a4634e-6458-40fb-8ce0-924b877b8c6a"
}
INFO:api.access:Body: {
  "query": "Does this patient have any chronic conditions? If so, what are they?",
  "session_id": "comprehensive-eval-12",
  "patient_id": "c4a4634e-6458-40fb-8ce0-924b877b8c6a"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:36,147 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:34:36,147 - api.access - INFO - Body: {
  "query": "chronic condition",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "chronic condition",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 54.51it/s]
2026-02-02 17:34:38,107 - api.access - INFO - Response: 200 in 1.9600s
INFO:api.access:Response: 200 in 1.9600s
INFO:     127.0.0.1:52089 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:34:45,413 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:34:45,413 - api.access - INFO - Body: {
  "query": "Condition resource with ID '11d4764c-8203-4819-b124-5b3a4a0e6939'",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Condition resource with ID '11d4764c-8203-4819-b124-5b3a4a0e6939'",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:34:47,372 - api.access - INFO - Response: 200 in 1.9591s
INFO:api.access:Response: 200 in 1.9591s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52099 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:00,230 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:35:00,230 - api.access - INFO - Body: {
  "query": "chronic conditions",
  "k_retrieve": 20,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "chronic conditions",
  "k_retrieve": 20,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7553' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7608' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7737' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7790' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 73.35it/s]
2026-02-02 17:35:02,870 - api.access - INFO - Response: 200 in 2.6397s
INFO:api.access:Response: 200 in 2.6397s
INFO:     127.0.0.1:52121 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:11,216 - api.access - INFO - Response: 200 in 35.8537s
INFO:api.access:Response: 200 in 35.8537s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:52086 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:35:11,238 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:35:11,238 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:52141 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:35:11,247 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:35:11,247 - api.access - INFO - Body: {
  "query": "What is the overall health status and medical background of this patient?",
  "session_id": "comprehensive-eval-13",
  "patient_id": "0e30d286-ff29-4836-b4b2-d2fa46574bf1"
}
INFO:api.access:Body: {
  "query": "What is the overall health status and medical background of this patient?",
  "session_id": "comprehensive-eval-13",
  "patient_id": "0e30d286-ff29-4836-b4b2-d2fa46574bf1"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:11,978 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:35:11,978 - api.access - INFO - Body: {
  "query": "overall health status and medical background",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "overall health status and medical background",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 33.56it/s]
2026-02-02 17:35:14,458 - api.access - INFO - Response: 200 in 2.4806s
INFO:api.access:Response: 200 in 2.4806s
INFO:     127.0.0.1:52146 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:24,190 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:35:24,190 - api.access - INFO - Body: {
  "query": "Patient with ICD-10 code E11.9 and recent medication changes",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "0e30d286-ff29-4836-b4b2-d2fa46574bf1"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Patient with ICD-10 code E11.9 and recent medication changes",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "0e30d286-ff29-4836-b4b2-d2fa46574bf1"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=0e30d286-ff29-4836-b4b2-d2fa46574bf1)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 59.52it/s]
2026-02-02 17:35:26,514 - api.access - INFO - Response: 200 in 2.3240s
INFO:api.access:Response: 200 in 2.3240s
INFO:     127.0.0.1:52159 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:38,806 - api.access - INFO - Response: 200 in 27.5588s
INFO:api.access:Response: 200 in 27.5588s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:52143 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:35:38,813 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:35:38,814 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:52175 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:35:38,820 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:35:38,820 - api.access - INFO - Body: {
  "query": "What care plans or treatment recommendations exist for this patient?",
  "session_id": "comprehensive-eval-14",
  "patient_id": "f883318e-9a81-4f77-9cff-5318a00b777f"
}
INFO:api.access:Body: {
  "query": "What care plans or treatment recommendations exist for this patient?",
  "session_id": "comprehensive-eval-14",
  "patient_id": "f883318e-9a81-4f77-9cff-5318a00b777f"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:39,852 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:35:39,852 - api.access - INFO - Body: {
  "query": "care plans or treatment recommendations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "care plans or treatment recommendations for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 17:35:41,924 - api.access - INFO - Response: 200 in 2.0726s
INFO:api.access:Response: 200 in 2.0726s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52181 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:48,432 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:35:48,433 - api.access - INFO - Body: {
  "query": "care plans or treatment recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "care plans or treatment recommendations",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7881' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-7957' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8015' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8089' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:35:50,810 - api.access - INFO - Response: 200 in 2.3780s
INFO:api.access:Response: 200 in 2.3780s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52198 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:35:56,419 - api.access - INFO - Response: 200 in 17.5995s
INFO:api.access:Response: 200 in 17.5995s
INFO:     127.0.0.1:52177 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:35:56,444 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:35:56,445 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:52218 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:35:56,454 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:35:56,454 - api.access - INFO - Body: {
  "query": "What active medications is this patient currently taking?",
  "session_id": "comprehensive-eval-15",
  "patient_id": "4b7098a8-13b8-4916-a379-6ae2c8a70a8a"
}
INFO:api.access:Body: {
  "query": "What active medications is this patient currently taking?",
  "session_id": "comprehensive-eval-15",
  "patient_id": "4b7098a8-13b8-4916-a379-6ae2c8a70a8a"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:43:38,149 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:43:38,149 - api.access - INFO - Body: {
  "query": "What are the patient's current medications?",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "What are the patient's current medications?",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 21.73it/s]
2026-02-02 17:43:43,022 - api.access - INFO - Response: 200 in 4.8731s
INFO:api.access:Response: 200 in 4.8731s
INFO:     127.0.0.1:52580 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:43:57,496 - api.access - INFO - Response: 200 in 481.0427s
INFO:api.access:Response: 200 in 481.0427s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:52220 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:43:57,515 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:43:57,515 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:52610 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:43:57,524 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:43:57,524 - api.access - INFO - Body: {
  "query": "What lab results are most recent for this patient?",
  "session_id": "comprehensive-eval-16",
  "patient_id": "e8f22d03-546d-4a48-83e5-4452f1c45065"
}
INFO:api.access:Body: {
  "query": "What lab results are most recent for this patient?",
  "session_id": "comprehensive-eval-16",
  "patient_id": "e8f22d03-546d-4a48-83e5-4452f1c45065"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:43:58,304 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:43:58,305 - api.access - INFO - Body: {
  "query": "lab results",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lab results",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:44:01,898 - api.access - INFO - Response: 200 in 3.5934s
INFO:api.access:Response: 200 in 3.5934s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52616 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query= "HTTP/1.1 400 Bad Request"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:08,660 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:44:08,660 - api.access - INFO - Body: {
  "query": "lab results for patient e8f22d03-546d-4a48-83e5-4452f1c45065",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "e8f22d03-546d-4a48-83e5-4452f1c45065"
  }
}
INFO:api.access:Body: {
  "query": "lab results for patient e8f22d03-546d-4a48-83e5-4452f1c45065",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "e8f22d03-546d-4a48-83e5-4452f1c45065"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8144' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8246' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8323' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 17:44:12,011 - api.access - INFO - Response: 200 in 3.3513s
INFO:api.access:Response: 200 in 3.3513s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=e8f22d03-546d-4a48-83e5-4452f1c45065)
INFO:     127.0.0.1:52635 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:16,625 - api.access - INFO - Response: 200 in 19.1017s
INFO:api.access:Response: 200 in 19.1017s
INFO:     127.0.0.1:52612 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:44:16,643 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:44:16,645 - api.access - INFO - Response: 200 in 0.0027s
INFO:api.access:Response: 200 in 0.0027s
INFO:     127.0.0.1:52649 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:44:16,655 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:44:16,655 - api.access - INFO - Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-17",
  "patient_id": "1cb33d44-8f73-4229-af17-e46c4013cb32"
}
INFO:api.access:Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-17",
  "patient_id": "1cb33d44-8f73-4229-af17-e46c4013cb32"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:17,370 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:44:17,370 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:44:19,397 - api.access - INFO - Response: 200 in 2.0274s
INFO:api.access:Response: 200 in 2.0274s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52653 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I15&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:24,978 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:44:24,978 - api.access - INFO - Body: {
  "query": "blood pressure",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "1cb33d44-8f73-4229-af17-e46c4013cb32"
  }
}
INFO:api.access:Body: {
  "query": "blood pressure",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "1cb33d44-8f73-4229-af17-e46c4013cb32"
  }
}
2026-02-02 17:44:26,951 - api.access - INFO - Response: 200 in 1.9726s
INFO:api.access:Response: 200 in 1.9726s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=1cb33d44-8f73-4229-af17-e46c4013cb32)
INFO:     127.0.0.1:52663 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:31,495 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:44:31,496 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:44:33,523 - api.access - INFO - Response: 200 in 2.0274s
INFO:api.access:Response: 200 in 2.0274s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52668 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:39,553 - api.access - INFO - Response: 200 in 22.8979s
INFO:api.access:Response: 200 in 22.8979s
INFO:     127.0.0.1:52651 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:44:39,566 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:44:39,566 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:52680 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:44:39,576 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:44:39,576 - api.access - INFO - Body: {
  "query": "What diagnostic imaging has been performed on this patient?",
  "session_id": "comprehensive-eval-18",
  "patient_id": "7a5e9861-010b-4e88-b6b9-28fec658edd4"
}
INFO:api.access:Body: {
  "query": "What diagnostic imaging has been performed on this patient?",
  "session_id": "comprehensive-eval-18",
  "patient_id": "7a5e9861-010b-4e88-b6b9-28fec658edd4"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:40,303 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 17:44:40,306 - api.access - INFO - Body: {
  "query": "diagnostic imaging",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "diagnostic imaging",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8378' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8451' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8506' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8559' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 13.36it/s]
2026-02-02 17:44:43,070 - api.access - INFO - Response: 200 in 2.7665s
INFO:api.access:Response: 200 in 2.7665s
INFO:     127.0.0.1:52684 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I25.11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:44:51,311 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:44:51,311 - api.access - INFO - Body: {
  "query": "Coronary Heart Disease (CHD) ICD-10 code I25.11",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Coronary Heart Disease (CHD) ICD-10 code I25.11",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 60.44it/s]
2026-02-02 17:44:53,579 - api.access - INFO - Response: 200 in 2.2686s
INFO:api.access:Response: 200 in 2.2686s
INFO:     127.0.0.1:52696 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I10&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=M79.6&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:45:09,951 - api.access - INFO - Response: 200 in 30.3751s
INFO:api.access:Response: 200 in 30.3751s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:52682 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 17:45:09,968 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 17:45:09,969 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:52722 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 17:45:09,977 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 17:45:09,977 - api.access - INFO - Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-19",
  "patient_id": "a5a04579-3dec-44cd-859b-c35122ff3afa"
}
INFO:api.access:Body: {
  "query": "What is this patient's blood pressure history?",
  "session_id": "comprehensive-eval-19",
  "patient_id": "a5a04579-3dec-44cd-859b-c35122ff3afa"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:45:10,695 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 17:45:10,696 - api.access - INFO - Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "blood pressure history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 17:45:13,000 - api.access - INFO - Response: 200 in 2.3047s
INFO:api.access:Response: 200 in 2.3047s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:52726 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8462-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 17:45:18,617 - api.access - INFO - Response: 200 in 8.6406s
INFO:api.access:Response: 200 in 8.6406s
INFO:     127.0.0.1:52724 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:06:41,552 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:06:41,553 - api.access - INFO - Response: 200 in 0.0016s
INFO:api.access:Response: 200 in 0.0016s
INFO:     127.0.0.1:53714 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:06:41,559 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:06:41,560 - api.access - INFO - Body: {
  "query": "Has this patient undergone a Subcutaneous immunotherapy? When?",
  "session_id": "verified-eval-0",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:api.access:Body: {
  "query": "Has this patient undergone a Subcutaneous immunotherapy? When?",
  "session_id": "verified-eval-0",
  "patient_id": "3e80196f-06df-4568-a5e5-480b742b8639"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:06:48,347 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:06:48,348 - api.access - INFO - Body: {
  "query": "Subcutaneous immunotherapy",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Subcutaneous immunotherapy",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8629' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8684' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8799' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:06:53,477 - api.access - INFO - Response: 200 in 5.1299s
INFO:api.access:Response: 200 in 5.1299s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53727 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=L3891-3 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:06:57,964 - api.access - INFO - Response: 200 in 16.4046s
INFO:api.access:Response: 200 in 16.4046s
INFO:     127.0.0.1:53716 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:06:57,985 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:06:57,986 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:53747 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:06:57,994 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:06:57,995 - api.access - INFO - Body: {
  "query": "What can you tell me about this patient's Prediabetes? When was it diagnosed?",
  "session_id": "verified-eval-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "What can you tell me about this patient's Prediabetes? When was it diagnosed?",
  "session_id": "verified-eval-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:06:58,715 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:06:58,715 - api.access - INFO - Body: {
  "query": "Prediabetes diagnosis",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Prediabetes diagnosis",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:07:01,446 - api.access - INFO - Response: 200 in 2.7319s
INFO:api.access:Response: 200 in 2.7319s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53751 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:07:10,789 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:07:10,790 - api.access - INFO - Body: {
  "query": "ClinicalNote prediabetes",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "ClinicalNote prediabetes",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
  },
  "include_full_json": true
}
Warning: Only found 10/50 results after filtering from 5000 candidates (patient_id=3f89ff20-09aa-40e7-a359-389863c7e574)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.67it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.67it/s]
2026-02-02 18:07:14,632 - api.access - INFO - Response: 200 in 3.8426s
INFO:api.access:Response: 200 in 3.8426s
INFO:     127.0.0.1:53763 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:07:24,561 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:07:24,561 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis date",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis date",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8870' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8941' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-8996' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:07:27,467 - api.access - INFO - Response: 200 in 2.9058s
INFO:api.access:Response: 200 in 2.9058s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53775 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:07:33,589 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:07:33,589 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis date",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis date",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:07:36,402 - api.access - INFO - Response: 200 in 2.8128s
INFO:api.access:Response: 200 in 2.8128s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53784 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:07:42,610 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:07:42,611 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis date E11",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis date E11",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:07:45,456 - api.access - INFO - Response: 200 in 2.8458s
INFO:api.access:Response: 200 in 2.8458s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53797 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:07:53,482 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:07:53,483 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis date E11",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis date E11",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:07:56,335 - api.access - INFO - Response: 200 in 2.8530s
INFO:api.access:Response: 200 in 2.8530s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53808 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Predmature+birth+with+other+specified+complications+of+labor&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Predmature+birth+with+other+specified+complications+of+labor&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:11,402 - api.access - INFO - Response: 500 in 73.4079s
INFO:api.access:Response: 500 in 73.4079s
Error in agent query [request_id=17929047-2be6-438d-8e58-1e351c366951]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:53749 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:08:13,429 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:08:13,431 - api.access - INFO - Response: 200 in 0.0014s
INFO:api.access:Response: 200 in 0.0014s
INFO:     127.0.0.1:53855 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:08:13,442 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:08:13,442 - api.access - INFO - Body: {
  "query": "What can you tell me about this patient's Prediabetes? When was it diagnosed?",
  "session_id": "verified-eval-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:api.access:Body: {
  "query": "What can you tell me about this patient's Prediabetes? When was it diagnosed?",
  "session_id": "verified-eval-1",
  "patient_id": "3f89ff20-09aa-40e7-a359-389863c7e574"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:14,351 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:08:14,352 - api.access - INFO - Body: {
  "query": "Prediabetes diagnosis",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Prediabetes diagnosis",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9054' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9109' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9164' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9219' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:08:17,941 - api.access - INFO - Response: 200 in 3.5894s
INFO:api.access:Response: 200 in 3.5894s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53868 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:27,694 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:08:27,694 - api.access - INFO - Body: {
  "query": "ClinicalNote prediabetes",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "ClinicalNote prediabetes",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:08:30,433 - api.access - INFO - Response: 200 in 2.7389s
INFO:api.access:Response: 200 in 2.7389s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53882 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:36,054 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:08:36,054 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis code E11",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis code E11",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:08:39,133 - api.access - INFO - Response: 200 in 3.0791s
INFO:api.access:Response: 200 in 3.0791s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53892 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:46,683 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:08:46,683 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9339' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9394' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9446' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:08:49,728 - api.access - INFO - Response: 200 in 3.0447s
INFO:api.access:Response: 200 in 3.0447s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53903 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:08:58,074 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:08:58,074 - api.access - INFO - Body: {
  "query": "prediabetes diagnosis",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "prediabetes diagnosis",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:09:01,057 - api.access - INFO - Response: 200 in 2.9834s
INFO:api.access:Response: 200 in 2.9834s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53929 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:12,974 - api.access - INFO - Response: 200 in 59.5319s
INFO:api.access:Response: 200 in 59.5319s
INFO:     127.0.0.1:53857 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:09:12,996 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:09:12,996 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:53948 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:09:13,009 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:09:13,009 - api.access - INFO - Body: {
  "query": "What was this patient's Urea Nitrogen on 2016-04-01?",
  "session_id": "verified-eval-2",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:api.access:Body: {
  "query": "What was this patient's Urea Nitrogen on 2016-04-01?",
  "session_id": "verified-eval-2",
  "patient_id": "5dcb9365-483d-48d7-bc62-816221b3f8b7"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:20,156 - api.access - INFO - Response: 200 in 7.1466s
INFO:api.access:Response: 200 in 7.1466s
INFO:     127.0.0.1:53950 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:09:20,168 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:09:20,168 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:53962 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:09:20,177 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:09:20,177 - api.access - INFO - Body: {
  "query": "What was this patient's Glucose on 2016-02-22?",
  "session_id": "verified-eval-3",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:api.access:Body: {
  "query": "What was this patient's Glucose on 2016-02-22?",
  "session_id": "verified-eval-3",
  "patient_id": "e149aa89-cc9e-483e-b78b-00f0433072e0"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:20,955 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:09:20,956 - api.access - INFO - Body: {
  "query": "Glucose on 2016-02-22",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Glucose on 2016-02-22",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:09:22,986 - api.access - INFO - Response: 200 in 2.0312s
INFO:api.access:Response: 200 in 2.0312s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53966 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=2162-0 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:40,679 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:09:40,679 - api.access - INFO - Body: {
  "query": "glucose level on January 1, 2022",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "glucose level on January 1, 2022",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:09:42,988 - api.access - INFO - Response: 200 in 2.3090s
INFO:api.access:Response: 200 in 2.3090s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53983 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:50,329 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:09:50,329 - api.access - INFO - Body: {
  "query": "Glucose/[date]",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Glucose/[date]",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9501' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9556' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9715' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9831' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:09:52,468 - api.access - INFO - Response: 200 in 2.1387s
INFO:api.access:Response: 200 in 2.1387s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:53993 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=2345-6 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:57,353 - api.access - INFO - Response: 200 in 37.1756s
INFO:api.access:Response: 200 in 37.1756s
INFO:     127.0.0.1:53964 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:09:57,368 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:09:57,368 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:54011 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:09:57,377 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:09:57,378 - api.access - INFO - Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:api.access:Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:09:58,192 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:09:58,192 - api.access - INFO - Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:10:00,188 - api.access - INFO - Response: 200 in 1.9969s
INFO:api.access:Response: 200 in 1.9969s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54016 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-8 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:06,496 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:10:06,496 - api.access - INFO - Body: {
  "query": "vaccination history or current medications",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history or current medications",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:10:08,448 - api.access - INFO - Response: 200 in 1.9522s
INFO:api.access:Response: 200 in 1.9522s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54027 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:15,356 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:10:15,356 - api.access - INFO - Body: {
  "query": "Influenza vaccine preservative free",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Influenza vaccine preservative free",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:10:17,290 - api.access - INFO - Response: 200 in 1.9346s
INFO:api.access:Response: 200 in 1.9346s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54036 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-8 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:26,450 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:10:26,451 - api.access - INFO - Body: {
  "query": "preservative-free flu vaccine",
  "k_retrieve": 10,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "preservative-free flu vaccine",
  "k_retrieve": 10,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9886' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-9956' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10011' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10066' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:10:28,607 - api.access - INFO - Response: 200 in 2.1569s
INFO:api.access:Response: 200 in 2.1569s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54047 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:35,350 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:10:35,350 - api.access - INFO - Body: {
  "query": "preservative-free flu vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "preservative-free flu vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:10:37,574 - api.access - INFO - Response: 200 in 2.2241s
INFO:api.access:Response: 200 in 2.2241s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54060 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8867-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:45,278 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:10:45,278 - api.access - INFO - Body: {
  "query": "vaccine type: COVID-19 mRNA",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccine type: COVID-19 mRNA",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:10:47,358 - api.access - INFO - Response: 200 in 2.0800s
INFO:api.access:Response: 200 in 2.0800s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54072 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90677-6 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:10:53,988 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:10:53,988 - api.access - INFO - Body: {
  "query": "seasonal influenza injectable vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "seasonal influenza injectable vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10118' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10173' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10228' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 7/50 results after filtering from 5000 candidates (patient_id=be36dfc3-e8f9-46d4-b02b-03466388c34d)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.01it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.00it/s]
2026-02-02 18:10:57,015 - api.access - INFO - Response: 200 in 3.0269s
INFO:api.access:Response: 200 in 3.0269s
INFO:     127.0.0.1:54081 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=LOINC%3A+84852-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:10,225 - api.access - INFO - Response: 500 in 72.8476s
INFO:api.access:Response: 500 in 72.8476s
Error in agent query [request_id=9bb47439-c002-4c7d-bec9-d35b5d4446c8]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:54013 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:11:12,257 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:11:12,258 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:54109 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:11:12,269 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:11:12,269 - api.access - INFO - Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:api.access:Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:13,346 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:11:13,347 - api.access - INFO - Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:11:16,230 - api.access - INFO - Response: 200 in 2.8841s
INFO:api.access:Response: 200 in 2.8841s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54113 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:22,262 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:11:22,263 - api.access - INFO - Body: {
  "query": "90646-7",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "90646-7",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:11:24,687 - api.access - INFO - Response: 200 in 2.4245s
INFO:api.access:Response: 200 in 2.4245s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54137 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:31,008 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:11:31,008 - api.access - INFO - Body: {
  "query": "vaccination history for patient with ID f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8 and LOINC code 90646-7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history for patient with ID f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8 and LOINC code 90646-7",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:11:33,368 - api.access - INFO - Response: 200 in 2.3604s
INFO:api.access:Response: 200 in 2.3604s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54145 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-7 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:38,940 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:11:38,940 - api.access - INFO - Body: {
  "query": "vaccination history for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10283' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10366' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10421' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10476' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:11:41,321 - api.access - INFO - Response: 200 in 2.3805s
INFO:api.access:Response: 200 in 2.3805s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54154 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:48,878 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:11:48,878 - api.access - INFO - Body: {
  "query": "vaccination history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:11:51,111 - api.access - INFO - Response: 200 in 2.2337s
INFO:api.access:Response: 200 in 2.2337s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54167 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:11:57,303 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:11:57,303 - api.access - INFO - Body: {
  "query": "vaccination history with LOINC code 90646-9",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history with LOINC code 90646-9",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:11:59,690 - api.access - INFO - Response: 200 in 2.3872s
INFO:api.access:Response: 200 in 2.3872s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54184 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:06,474 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:12:06,474 - api.access - INFO - Body: {
  "query": "vaccination history with LOINC code 90646-9",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "vaccination history with LOINC code 90646-9",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10531' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10586' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10641' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 3/50 results after filtering from 5000 candidates (patient_id=be36dfc3-e8f9-46d4-b02b-03466388c34d)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 18.20it/s]
2026-02-02 18:12:09,398 - api.access - INFO - Response: 200 in 2.9244s
INFO:api.access:Response: 200 in 2.9244s
INFO:     127.0.0.1:54195 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B91&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:25,249 - api.access - INFO - Response: 500 in 72.9802s
INFO:api.access:Response: 500 in 72.9802s
Error in agent query [request_id=01c81289-48b3-41be-aac7-a97ffba69cb0]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:54111 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:12:27,280 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:12:27,281 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:54211 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:12:27,292 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:12:27,293 - api.access - INFO - Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:api.access:Body: {
  "query": "Has this patient received a Influenza, seasonal, injectable, preservative free vaccine? When?",
  "session_id": "verified-eval-4",
  "patient_id": "be36dfc3-e8f9-46d4-b02b-03466388c34d"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:28,406 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:12:28,407 - api.access - INFO - Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Influenza, seasonal, injectable, preservative free vaccine",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:12:30,701 - api.access - INFO - Response: 200 in 2.2953s
INFO:api.access:Response: 200 in 2.2953s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54215 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-8 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:37,007 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:12:37,008 - api.access - INFO - Body: {
  "query": "Influenza, seasonal, injectable, preservative-free vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Influenza, seasonal, injectable, preservative-free vaccine",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:12:39,226 - api.access - INFO - Response: 200 in 2.2186s
INFO:api.access:Response: 200 in 2.2186s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54225 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=90646-8 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=B95.6&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:53,932 - api.access - INFO - Response: 200 in 26.6398s
INFO:api.access:Response: 200 in 26.6398s
INFO:     127.0.0.1:54213 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:12:53,949 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:12:53,950 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:54241 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:12:53,955 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:12:53,956 - api.access - INFO - Body: {
  "query": "Does this patient have Acute bronchitis (disorder)? Provide details.",
  "session_id": "verified-eval-5",
  "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
}
INFO:api.access:Body: {
  "query": "Does this patient have Acute bronchitis (disorder)? Provide details.",
  "session_id": "verified-eval-5",
  "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Acute+bronchitis+%28disorder%29&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:12:57,801 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:12:57,802 - api.access - INFO - Body: {
  "query": "Acute bronchitis (disorder)",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
  }
}
INFO:api.access:Body: {
  "query": "Acute bronchitis (disorder)",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10696' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10779' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10834' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 8/50 results after filtering from 5000 candidates (patient_id=d0b81fcd-b4a2-43d9-99ac-8fe6dd6f4921)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.71it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  4.71it/s]
2026-02-02 18:13:00,207 - api.access - INFO - Response: 200 in 2.4059s
INFO:api.access:Response: 200 in 2.4059s
INFO:     127.0.0.1:54266 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J40&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J30&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J30&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J30.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J20.9&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J20.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:13:13,952 - api.access - INFO - Response: 200 in 19.9975s
INFO:api.access:Response: 200 in 19.9975s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54243 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:13:13,959 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:13:13,959 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:54288 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:13:13,965 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:13:13,965 - api.access - INFO - Body: {
  "query": "What can you tell me about this patient's Acute bronchitis (disorder)? When was it diagnosed?",
  "session_id": "verified-eval-6",
  "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
}
INFO:api.access:Body: {
  "query": "What can you tell me about this patient's Acute bronchitis (disorder)? When was it diagnosed?",
  "session_id": "verified-eval-6",
  "patient_id": "723d6d77-8a55-424b-b4fc-99e3b48e7e73"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Acute+bronchitis&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J20.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:13:18,823 - api.access - INFO - Response: 200 in 4.8572s
INFO:api.access:Response: 200 in 4.8572s
INFO:     127.0.0.1:54290 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:13:18,829 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:13:18,829 - api.access - INFO - Response: 200 in 0.0002s
INFO:api.access:Response: 200 in 0.0002s
INFO:     127.0.0.1:54296 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:13:18,835 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:13:18,835 - api.access - INFO - Body: {
  "query": "Did this patient have a Encounter for problem encounter on 2016-11-18?",
  "session_id": "verified-eval-7",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:api.access:Body: {
  "query": "Did this patient have a Encounter for problem encounter on 2016-11-18?",
  "session_id": "verified-eval-7",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.90XA&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:13:24,201 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:13:24,201 - api.access - INFO - Body: {
  "query": "problem encounter on 2016-11-18",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "problem encounter on 2016-11-18",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
Warning: Only found 20/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.16it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.16it/s]
2026-02-02 18:13:26,546 - api.access - INFO - Response: 200 in 2.3453s
INFO:api.access:Response: 200 in 2.3453s
INFO:     127.0.0.1:54304 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=C43&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=C43&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=C43.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=C43.0&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S00&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:13:58,489 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:13:58,489 - api.access - INFO - Body: {
  "query": "Patient ID format error: [MEDIUM] Incorrect UUID format.",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Patient ID format error: [MEDIUM] Incorrect UUID format.",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
Warning: Only found 4/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 14.27it/s]
2026-02-02 18:14:00,840 - api.access - INFO - Response: 200 in 2.3510s
INFO:api.access:Response: 200 in 2.3510s
INFO:     127.0.0.1:54346 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:14:12,759 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:14:12,759 - api.access - INFO - Body: {
  "query": "Encounter/123",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter/123",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
Warning: Only found 5/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 10.95it/s]
2026-02-02 18:14:14,972 - api.access - INFO - Response: 200 in 2.2128s
INFO:api.access:Response: 200 in 2.2128s
INFO:     127.0.0.1:54361 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z85.430&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:14:23,246 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:14:23,246 - api.access - INFO - Body: {
  "query": "Encounter",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-10956' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11216' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11401' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11459' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 6/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.82it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  3.44it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  3.03it/s]
2026-02-02 18:14:26,203 - api.access - INFO - Response: 200 in 2.9564s
INFO:api.access:Response: 200 in 2.9564s
INFO:     127.0.0.1:54385 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:14:31,624 - api.access - INFO - Response: 500 in 72.7900s
INFO:api.access:Response: 500 in 72.7900s
Error in agent query [request_id=97e9f6fd-0ff0-4b7f-8bf5-a4be69d8912f]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:54298 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:14:33,637 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:14:33,637 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:54394 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:14:33,643 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:14:33,643 - api.access - INFO - Body: {
  "query": "Did this patient have a Encounter for problem encounter on 2016-11-18?",
  "session_id": "verified-eval-7",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:api.access:Body: {
  "query": "Did this patient have a Encounter for problem encounter on 2016-11-18?",
  "session_id": "verified-eval-7",
  "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.90XA&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.90XA&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S09.90XA&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:14:53,088 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:14:53,089 - api.access - INFO - Body: {
  "query": "problem encounter on 2016-11-18",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "problem encounter on 2016-11-18",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "72790c7f-7ee6-400f-aba9-b4bea77d929a"
  },
  "include_full_json": true
}
2026-02-02 18:14:55,368 - api.access - INFO - Response: 200 in 2.2796s
INFO:api.access:Response: 200 in 2.2796s
Warning: Only found 20/50 results after filtering from 5000 candidates (patient_id=72790c7f-7ee6-400f-aba9-b4bea77d929a)
INFO:     127.0.0.1:54419 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S00&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:02,790 - api.access - INFO - Response: 200 in 29.1474s
INFO:api.access:Response: 200 in 29.1474s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54396 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:15:02,806 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:15:02,807 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:54440 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:15:02,818 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:15:02,818 - api.access - INFO - Body: {
  "query": "What was this patient's Triglycerides on 2017-03-21?",
  "session_id": "verified-eval-8",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:api.access:Body: {
  "query": "What was this patient's Triglycerides on 2017-03-21?",
  "session_id": "verified-eval-8",
  "patient_id": "c19e653d-f0d3-4a08-817a-ad0da990a288"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:03,619 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:15:03,621 - api.access - INFO - Body: {
  "query": "Triglycerides on 2017-03-21",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Triglycerides on 2017-03-21",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:15:05,711 - api.access - INFO - Response: 200 in 2.0912s
INFO:api.access:Response: 200 in 2.0912s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54447 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E78.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:11,131 - api.access - INFO - Response: 200 in 8.3135s
INFO:api.access:Response: 200 in 8.3135s
INFO:     127.0.0.1:54442 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:15:11,157 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:15:11,157 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:54456 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:15:11,168 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:15:11,168 - api.access - INFO - Body: {
  "query": "Did this patient have a Encounter for symptom encounter on 2013-06-26?",
  "session_id": "verified-eval-9",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:api.access:Body: {
  "query": "Did this patient have a Encounter for symptom encounter on 2013-06-26?",
  "session_id": "verified-eval-9",
  "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Symptom+encounter&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:13,586 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:15:13,586 - api.access - INFO - Body: {
  "query": "Encounter symptom 2013-06-26",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter symptom 2013-06-26",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "d930e322-8c86-4c17-8ce8-217cb252e2e4"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11516' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11692' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11766' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 4/50 results after filtering from 5000 candidates (patient_id=d930e322-8c86-4c17-8ce8-217cb252e2e4)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 14.02it/s]
2026-02-02 18:15:16,046 - api.access - INFO - Response: 200 in 2.4596s
INFO:api.access:Response: 200 in 2.4596s
INFO:     127.0.0.1:54462 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:28,015 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:15:28,016 - api.access - INFO - Body: {
  "query": "Observation/1234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation/1234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:15:30,452 - api.access - INFO - Response: 200 in 2.4364s
INFO:api.access:Response: 200 in 2.4364s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54474 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=S36.0x3A&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:36,423 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:15:36,423 - api.access - INFO - Body: {
  "query": "Observation/1234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation/1234",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:15:38,574 - api.access - INFO - Response: 200 in 2.1513s
INFO:api.access:Response: 200 in 2.1513s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54486 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:46,031 - api.access - INFO - Response: 200 in 34.8630s
INFO:api.access:Response: 200 in 34.8630s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54458 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:15:46,048 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:15:46,048 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:54499 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:15:46,057 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:15:46,058 - api.access - INFO - Body: {
  "query": "What was this patient's Body Weight on 2014-04-01?",
  "session_id": "verified-eval-10",
  "patient_id": "4df5d686-0a2d-4322-9a9e-40a76a252486"
}
INFO:api.access:Body: {
  "query": "What was this patient's Body Weight on 2014-04-01?",
  "session_id": "verified-eval-10",
  "patient_id": "4df5d686-0a2d-4322-9a9e-40a76a252486"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:15:56,093 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:15:56,093 - api.access - INFO - Body: {
  "query": "Observation effectiveDateTime 2014-04-01",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation effectiveDateTime 2014-04-01",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11849' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11907' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11962' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:15:59,123 - api.access - INFO - Response: 200 in 3.0303s
INFO:api.access:Response: 200 in 3.0303s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54522 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z91.81&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:06,430 - api.access - INFO - Response: 200 in 20.3728s
INFO:api.access:Response: 200 in 20.3728s
INFO:     127.0.0.1:54501 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:16:06,450 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:16:06,450 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:54541 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:16:06,462 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:16:06,462 - api.access - INFO - Body: {
  "query": "What was this patient's Soybean IgE Ab in Serum on 2012-05-11?",
  "session_id": "verified-eval-11",
  "patient_id": "169e6f60-d231-4093-93bf-5ae317c9ca7c"
}
INFO:api.access:Body: {
  "query": "What was this patient's Soybean IgE Ab in Serum on 2012-05-11?",
  "session_id": "verified-eval-11",
  "patient_id": "169e6f60-d231-4093-93bf-5ae317c9ca7c"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:07,297 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:16:07,298 - api.access - INFO - Body: {
  "query": "Soybean IgE Ab in Serum on 2012-05-11",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Soybean IgE Ab in Serum on 2012-05-11",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:16:09,791 - api.access - INFO - Response: 200 in 2.4932s
INFO:api.access:Response: 200 in 2.4932s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54545 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:18,086 - api.access - INFO - Response: 200 in 11.6240s
INFO:api.access:Response: 200 in 11.6240s
INFO:     127.0.0.1:54543 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:16:18,105 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:16:18,105 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:54562 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:16:18,113 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:16:18,113 - api.access - INFO - Body: {
  "query": "What was this patient's Sodium on 2013-10-02?",
  "session_id": "verified-eval-12",
  "patient_id": "55705808-dd8c-4575-b8d5-995d65c08841"
}
INFO:api.access:Body: {
  "query": "What was this patient's Sodium on 2013-10-02?",
  "session_id": "verified-eval-12",
  "patient_id": "55705808-dd8c-4575-b8d5-995d65c08841"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:18,906 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:16:18,906 - api.access - INFO - Body: {
  "query": "Sodium on 2013-10-02",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Sodium on 2013-10-02",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:16:21,629 - api.access - INFO - Response: 200 in 2.7233s
INFO:api.access:Response: 200 in 2.7233s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54567 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E86.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:26,620 - api.access - INFO - Response: 200 in 8.5072s
INFO:api.access:Response: 200 in 8.5072s
INFO:     127.0.0.1:54564 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:16:26,635 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:16:26,635 - api.access - INFO - Response: 200 in 0.0004s
INFO:api.access:Response: 200 in 0.0004s
INFO:     127.0.0.1:54583 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:16:26,644 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:16:26,644 - api.access - INFO - Body: {
  "query": "What was this patient's Urea Nitrogen on 2011-01-10?",
  "session_id": "verified-eval-13",
  "patient_id": "2946215b-2b3d-4082-bc36-3a8f61f59944"
}
INFO:api.access:Body: {
  "query": "What was this patient's Urea Nitrogen on 2011-01-10?",
  "session_id": "verified-eval-13",
  "patient_id": "2946215b-2b3d-4082-bc36-3a8f61f59944"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:27,436 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:16:27,436 - api.access - INFO - Body: {
  "query": "Urea Nitrogen on 2011-01-10",
  "k_retrieve": 100,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Urea Nitrogen on 2011-01-10",
  "k_retrieve": 100,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12075' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12145' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12215' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:16:29,686 - api.access - INFO - Response: 200 in 2.2502s
INFO:api.access:Response: 200 in 2.2502s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54589 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Urea+Nitrogen "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:35,928 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:16:35,928 - api.access - INFO - Body: {
  "query": "Urea Nitrogen on 2011-01-10",
  "k_retrieve": 4000,
  "k_return": 1000,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Urea Nitrogen on 2011-01-10",
  "k_retrieve": 4000,
  "k_return": 1000,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:16:38,378 - api.access - INFO - Response: 200 in 2.4507s
INFO:api.access:Response: 200 in 2.4507s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54600 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:43,909 - api.access - INFO - Response: 200 in 17.2648s
INFO:api.access:Response: 200 in 17.2648s
INFO:     127.0.0.1:54585 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:16:43,930 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:16:43,931 - api.access - INFO - Response: 200 in 0.0003s
INFO:api.access:Response: 200 in 0.0003s
INFO:     127.0.0.1:54615 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:16:43,937 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:16:43,937 - api.access - INFO - Body: {
  "query": "What was this patient's Wheat IgE Ab in Serum on 2012-04-24?",
  "session_id": "verified-eval-14",
  "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
}
INFO:api.access:Body: {
  "query": "What was this patient's Wheat IgE Ab in Serum on 2012-04-24?",
  "session_id": "verified-eval-14",
  "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:44,757 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:16:44,757 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:16:46,934 - api.access - INFO - Response: 200 in 2.1772s
INFO:api.access:Response: 200 in 2.1772s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54623 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:16:54,762 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:16:54,762 - api.access - INFO - Body: {
  "query": "lab results for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8 on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "lab results for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8 on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:16:56,639 - api.access - INFO - Response: 200 in 1.8771s
INFO:api.access:Response: 200 in 1.8771s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54637 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab+in+Serum "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:03,341 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:17:03,341 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12285' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12340' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12410' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12464' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:17:05,308 - api.access - INFO - Response: 200 in 1.9670s
INFO:api.access:Response: 200 in 1.9670s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54645 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab+in+Serum "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:13,216 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:17:13,216 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum LOINC code 12345-6 on 2012-04-24",
  "k_retrieve": 20,
  "k_return": 0,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum LOINC code 12345-6 on 2012-04-24",
  "k_retrieve": 20,
  "k_return": 0,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:17:13,219 - api.access - INFO - Response: 422 in 0.0037s
INFO:api.access:Response: 422 in 0.0037s
INFO:     127.0.0.1:54654 - "POST /retrieval/rerank/with-context HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 18:17:13,231 - api.access - INFO - Response: 500 in 29.2942s
INFO:api.access:Response: 500 in 29.2942s
Error in agent query [request_id=1851dc79-9260-49f0-9812-ad6674bdc1c9]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank/with-context'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '8cef14b0-e953-1143-d599-6e920cdee945'
During task with name 'researcher' and id 'c59db14e-246a-caba-9aa3-4e780221cc02'

INFO:     127.0.0.1:54617 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:17:15,249 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:17:15,250 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:54657 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:17:15,262 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:17:15,262 - api.access - INFO - Body: {
  "query": "What was this patient's Wheat IgE Ab in Serum on 2012-04-24?",
  "session_id": "verified-eval-14",
  "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
}
INFO:api.access:Body: {
  "query": "What was this patient's Wheat IgE Ab in Serum on 2012-04-24?",
  "session_id": "verified-eval-14",
  "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:16,292 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:17:16,292 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:17:18,265 - api.access - INFO - Response: 200 in 1.9737s
INFO:api.access:Response: 200 in 1.9737s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54661 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab+in+Serum "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:23,943 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:17:23,943 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
  },
  "include_full_json": true
}
Warning: Only found 38/50 results after filtering from 5000 candidates (patient_id=9ba714e9-54c3-48d6-8d75-90c3590957ae)
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.68it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.95it/s]
2026-02-02 18:17:27,098 - api.access - INFO - Response: 200 in 3.1550s
INFO:api.access:Response: 200 in 3.1550s
INFO:     127.0.0.1:54678 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:34,971 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:17:34,971 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "9ba714e9-54c3-48d6-8d75-90c3590957ae"
  },
  "include_full_json": true
}
Warning: Only found 39/50 results after filtering from 5000 candidates (patient_id=9ba714e9-54c3-48d6-8d75-90c3590957ae)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.02it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.02it/s]
2026-02-02 18:17:37,392 - api.access - INFO - Response: 200 in 2.4213s
INFO:api.access:Response: 200 in 2.4213s
INFO:     127.0.0.1:54686 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:17:45,857 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:17:45,858 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12519' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12599' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12654' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12712' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:17:47,964 - api.access - INFO - Response: 200 in 2.1067s
INFO:api.access:Response: 200 in 2.1067s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54696 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:06,315 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:18:06,315 - api.access - INFO - Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Wheat IgE Ab in Serum on 2012-04-24",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:18:08,338 - api.access - INFO - Response: 200 in 2.0233s
INFO:api.access:Response: 200 in 2.0233s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54738 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Wheat+IgE+Ab+in+Serum "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:16,703 - api.access - INFO - Response: 200 in 61.4414s
INFO:api.access:Response: 200 in 61.4414s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54659 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:18:16,726 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:18:16,727 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:54747 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:18:16,737 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:18:16,737 - api.access - INFO - Body: {
  "query": "What was this patient's Oral temperature on 2015-11-28?",
  "session_id": "verified-eval-15",
  "patient_id": "0d55431b-966c-4b08-a71a-f6266b2c695d"
}
INFO:api.access:Body: {
  "query": "What was this patient's Oral temperature on 2015-11-28?",
  "session_id": "verified-eval-15",
  "patient_id": "0d55431b-966c-4b08-a71a-f6266b2c695d"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:17,595 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:18:17,595 - api.access - INFO - Body: {
  "query": "Oral temperature on 2015-11-28",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Oral temperature on 2015-11-28",
  "k_retrieve": 10,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:18:19,504 - api.access - INFO - Response: 200 in 1.9096s
INFO:api.access:Response: 200 in 1.9096s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54753 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:25,880 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:18:25,880 - api.access - INFO - Body: {
  "query": "Oral temperature on 2015-11-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0d55431b-966c-4b08-a71a-f6266b2c695d"
  }
}
INFO:api.access:Body: {
  "query": "Oral temperature on 2015-11-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0d55431b-966c-4b08-a71a-f6266b2c695d"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12770' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12836' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12907' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 7/50 results after filtering from 5000 candidates (patient_id=0d55431b-966c-4b08-a71a-f6266b2c695d)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.93it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  7.93it/s]
2026-02-02 18:18:28,425 - api.access - INFO - Response: 200 in 2.5456s
INFO:api.access:Response: 200 in 2.5456s
INFO:     127.0.0.1:54759 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=J02.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=8462-4 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:37,559 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:18:37,559 - api.access - INFO - Body: {
  "query": "oral temperature on November 28, 2015",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "oral temperature on November 28, 2015",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:18:39,565 - api.access - INFO - Response: 200 in 2.0055s
INFO:api.access:Response: 200 in 2.0055s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54771 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=BODYTEMP "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:47,388 - api.access - INFO - Response: 200 in 30.6507s
INFO:api.access:Response: 200 in 30.6507s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54749 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:18:47,408 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:18:47,409 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:54781 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:18:47,420 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:18:47,420 - api.access - INFO - Body: {
  "query": "What was this patient's Calcium on 2012-06-28?",
  "session_id": "verified-eval-16",
  "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
}
INFO:api.access:Body: {
  "query": "What was this patient's Calcium on 2012-06-28?",
  "session_id": "verified-eval-16",
  "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:48,196 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:18:48,197 - api.access - INFO - Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 63.65it/s]
2026-02-02 18:18:50,434 - api.access - INFO - Response: 200 in 2.2373s
INFO:api.access:Response: 200 in 2.2373s
INFO:     127.0.0.1:54785 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=I48&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:18:56,301 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:18:56,301 - api.access - INFO - Body: {
  "query": "Condition clinical status",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "11d4764c-8203-4819-b124-5b3a4a0e6939"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Condition clinical status",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "11d4764c-8203-4819-b124-5b3a4a0e6939"
  },
  "include_full_json": true
}
2026-02-02 18:18:58,435 - api.access - INFO - Response: 200 in 2.1346s
INFO:api.access:Response: 200 in 2.1346s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=11d4764c-8203-4819-b124-5b3a4a0e6939)
INFO:     127.0.0.1:54812 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=140-9 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12961' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13026' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13096' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13151' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:19:04,999 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:19:04,999 - api.access - INFO - Body: {
  "query": "[LOINC CODE] on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "[LOINC CODE] on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:19:07,190 - api.access - INFO - Response: 200 in 2.1911s
INFO:api.access:Response: 200 in 2.1911s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54820 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=Calcium+on+2012-06-28 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:19:13,724 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:19:13,724 - api.access - INFO - Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
  },
  "include_full_json": true
}
Warning: Only found 18/50 results after filtering from 5000 candidates (patient_id=eec43f2c-0956-485b-8eee-e448c53264a8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.00it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.00it/s]
2026-02-02 18:19:16,555 - api.access - INFO - Response: 200 in 2.8304s
INFO:api.access:Response: 200 in 2.8304s
INFO:     127.0.0.1:54827 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:19:34,164 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:19:34,164 - api.access - INFO - Body: {
  "query": "serum calcium level on 2012-06-28",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "serum calcium level on 2012-06-28",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:19:36,411 - api.access - INFO - Response: 200 in 2.2464s
INFO:api.access:Response: 200 in 2.2464s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54842 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E70&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:19:44,164 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:19:44,164 - api.access - INFO - Body: {
  "query": "serum calcium level on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "serum calcium level on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13206' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13261' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13358' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:19:46,742 - api.access - INFO - Response: 200 in 2.5779s
INFO:api.access:Response: 200 in 2.5779s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54853 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:19:57,237 - api.access - INFO - Response: 500 in 69.8173s
INFO:api.access:Response: 500 in 69.8173s
Error in agent query [request_id=2d7c8e17-e94d-459c-878c-5b209447d552]: GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3014, in astream
    raise GraphRecursionError(msg)
langgraph.errors.GraphRecursionError: Recursion limit of 15 reached without hitting a stop condition. You can increase the limit by setting the `recursion_limit` config key.
For troubleshooting, visit: https://docs.langchain.com/oss/python/langgraph/errors/GRAPH_RECURSION_LIMIT

INFO:     127.0.0.1:54783 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:19:59,266 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:19:59,267 - api.access - INFO - Response: 200 in 0.0006s
INFO:api.access:Response: 200 in 0.0006s
INFO:     127.0.0.1:54876 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:19:59,279 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:19:59,280 - api.access - INFO - Body: {
  "query": "What was this patient's Calcium on 2012-06-28?",
  "session_id": "verified-eval-16",
  "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
}
INFO:api.access:Body: {
  "query": "What was this patient's Calcium on 2012-06-28?",
  "session_id": "verified-eval-16",
  "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:00,193 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:20:00,193 - api.access - INFO - Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:20:02,617 - api.access - INFO - Response: 200 in 2.4246s
INFO:api.access:Response: 200 in 2.4246s
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54880 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://loinc.regenstrief.org/searchapi/loincs?query=000006 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:08,400 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:20:08,400 - api.access - INFO - Body: {
  "query": "calcium level on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "calcium level on 2012-06-28",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:20:10,752 - api.access - INFO - Response: 200 in 2.3519s
INFO:api.access:Response: 200 in 2.3519s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54890 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:19,472 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:20:19,472 - api.access - INFO - Body: {
  "query": "Observation calcium level",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Observation calcium level",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "eec43f2c-0956-485b-8eee-e448c53264a8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13413' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13490' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13545' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 18/50 results after filtering from 5000 candidates (patient_id=eec43f2c-0956-485b-8eee-e448c53264a8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.55it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.55it/s]
2026-02-02 18:20:22,463 - api.access - INFO - Response: 200 in 2.9914s
INFO:api.access:Response: 200 in 2.9914s
INFO:     127.0.0.1:54910 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:31,448 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:20:31,449 - api.access - INFO - Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Calcium on 2012-06-28",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:20:33,825 - api.access - INFO - Response: 200 in 2.3761s
INFO:api.access:Response: 200 in 2.3761s
Warning: Only found 1/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54923 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E21&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:48,604 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:20:48,604 - api.access - INFO - Body: {
  "query": "urn:uuid:f1d4764c-8203-4819-b124-5b3a4a0e6939",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "f1d4764c-8203-4819-b124-5b3a4a0e6939"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "urn:uuid:f1d4764c-8203-4819-b124-5b3a4a0e6939",
  "k_retrieve": 400,
  "k_return": 100,
  "filter_metadata": {
    "patient_id": "f1d4764c-8203-4819-b124-5b3a4a0e6939"
  },
  "include_full_json": true
}
2026-02-02 18:20:50,505 - api.access - INFO - Response: 200 in 1.9011s
INFO:api.access:Response: 200 in 1.9011s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d4764c-8203-4819-b124-5b3a4a0e6939)
INFO:     127.0.0.1:54939 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E63.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:54,783 - api.access - INFO - Response: 200 in 55.5036s
INFO:api.access:Response: 200 in 55.5036s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54878 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:20:54,806 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:20:54,807 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:54961 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:20:54,815 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:20:54,815 - api.access - INFO - Body: {
  "query": "What was this patient's Calcium on 2015-10-04?",
  "session_id": "verified-eval-17",
  "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
}
INFO:api.access:Body: {
  "query": "What was this patient's Calcium on 2015-10-04?",
  "session_id": "verified-eval-17",
  "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:20:55,598 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:20:55,599 - api.access - INFO - Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:20:57,461 - api.access - INFO - Response: 200 in 1.8631s
INFO:api.access:Response: 200 in 1.8631s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54966 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E70&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:03,691 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:21:03,691 - api.access - INFO - Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 20,
  "k_return": 0,
  "filter_metadata": {
    "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
  }
}
INFO:api.access:Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 20,
  "k_return": 0,
  "filter_metadata": {
    "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
  }
}
2026-02-02 18:21:03,692 - api.access - INFO - Response: 422 in 0.0010s
INFO:api.access:Response: 422 in 0.0010s
INFO:     127.0.0.1:54977 - "POST /retrieval/rerank HTTP/1.1" 422 Unprocessable Entity
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank "HTTP/1.1 422 Unprocessable Entity"
2026-02-02 18:21:03,704 - api.access - INFO - Response: 500 in 8.8885s
INFO:api.access:Response: 500 in 8.8885s
Error in agent query [request_id=a4703609-8360-41d7-980e-4f5eb1e0cbaf]: HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
Traceback: Traceback (most recent call last):
  File "/Users/raph/Documents/hc_ai/api/agent/router.py", line 82, in query_agent
    result = await asyncio.wait_for(
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.13/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
    return fut.result()
           ^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/multi_agent_graph.py", line 239, in _researcher_node
    result = await agent.ainvoke({"messages": messages}, config={"recursion_limit": max_iterations})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 832, in _afunc
    outputs = await asyncio.gather(*coros)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1163, in _arun_one
    return await self._execute_tool_async(tool_request, input_type, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1112, in _execute_tool_async
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
              ^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langgraph/prebuilt/tool_node.py", line 1069, in _execute_tool_async
    response = await tool.ainvoke(call_args, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 67, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 642, in ainvoke
    return await self.arun(tool_input, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1117, in arun
    raise error_to_raise
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/base.py", line 1083, in arun
    response = await coro_with_context(coro, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/langchain_core/tools/structured.py", line 121, in _arun
    return await self.coroutine(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raph/Documents/hc_ai/api/agent/tools/retrieval.py", line 91, in search_patient_records
    response.raise_for_status()
  File "/Users/raph/Documents/hc_ai/.venv/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '422 Unprocessable Entity' for url 'http://localhost:8000/retrieval/rerank'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422
During task with name 'tools' and id '8893c86c-a1e1-99ed-5eef-69f2fdb9b218'
During task with name 'researcher' and id '7f24d50e-4a8c-ec07-61c6-1f6ad7d64f62'

INFO:     127.0.0.1:54963 - "POST /agent/query HTTP/1.1" 500 Internal Server Error
2026-02-02 18:21:05,725 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:21:05,727 - api.access - INFO - Response: 200 in 0.0011s
INFO:api.access:Response: 200 in 0.0011s
INFO:     127.0.0.1:54979 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:21:05,740 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:21:05,740 - api.access - INFO - Body: {
  "query": "What was this patient's Calcium on 2015-10-04?",
  "session_id": "verified-eval-17",
  "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
}
INFO:api.access:Body: {
  "query": "What was this patient's Calcium on 2015-10-04?",
  "session_id": "verified-eval-17",
  "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:06,752 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:21:06,753 - api.access - INFO - Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Calcium on 2015-10-04",
  "k_retrieve": 1,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13600' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13658' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13717' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13787' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:21:08,751 - api.access - INFO - Response: 200 in 1.9984s
INFO:api.access:Response: 200 in 1.9984s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:54984 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E70&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:14,962 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:21:14,962 - api.access - INFO - Body: {
  "query": "calcium levels on October 4th, 2015",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "calcium levels on October 4th, 2015",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "473f09d5-1dd6-4127-80fb-ca0708cc9828"
  },
  "include_full_json": true
}
Warning: Only found 16/50 results after filtering from 5000 candidates (patient_id=473f09d5-1dd6-4127-80fb-ca0708cc9828)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.96it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.96it/s]
2026-02-02 18:21:17,263 - api.access - INFO - Response: 200 in 2.3006s
INFO:api.access:Response: 200 in 2.3006s
INFO:     127.0.0.1:54992 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E70&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:31,239 - api.access - INFO - Response: 200 in 25.4992s
INFO:api.access:Response: 200 in 25.4992s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:54981 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:21:31,254 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:21:31,255 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:55011 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:21:31,265 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:21:31,265 - api.access - INFO - Body: {
  "query": "What was this patient's Sodium on 2016-09-20?",
  "session_id": "verified-eval-18",
  "patient_id": "48923d94-fbc3-420d-be19-aa92c3969a3e"
}
INFO:api.access:Body: {
  "query": "What was this patient's Sodium on 2016-09-20?",
  "session_id": "verified-eval-18",
  "patient_id": "48923d94-fbc3-420d-be19-aa92c3969a3e"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:32,043 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 18:21:32,045 - api.access - INFO - Body: {
  "query": "Sodium on 2016-09-20",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "Sodium on 2016-09-20",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 18:21:34,169 - api.access - INFO - Response: 200 in 2.1253s
INFO:api.access:Response: 200 in 2.1253s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55016 - "POST /retrieval/rerank HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E86.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:41,179 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:21:41,179 - api.access - INFO - Body: {
  "query": "Sodium on 2016-09-20",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Sodium on 2016-09-20",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13867' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13922' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14034' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:21:43,352 - api.access - INFO - Response: 200 in 2.1731s
INFO:api.access:Response: 200 in 2.1731s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55029 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=E11.9&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:49,272 - api.access - INFO - Response: 200 in 18.0068s
INFO:api.access:Response: 200 in 18.0068s
INFO:     127.0.0.1:55013 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 18:21:49,290 - api.access - INFO - Request: GET /agent/health
INFO:api.access:Request: GET /agent/health
2026-02-02 18:21:49,290 - api.access - INFO - Response: 200 in 0.0005s
INFO:api.access:Response: 200 in 0.0005s
INFO:     127.0.0.1:55038 - "GET /agent/health HTTP/1.1" 200 OK
2026-02-02 18:21:49,303 - api.access - INFO - Request: POST /agent/query
INFO:api.access:Request: POST /agent/query
2026-02-02 18:21:49,303 - api.access - INFO - Body: {
  "query": "Did this patient have a Outpatient procedure encounter on 2013-04-08?",
  "session_id": "verified-eval-19",
  "patient_id": "0916adfb-4f71-43ae-9a95-0f89156130bd"
}
INFO:api.access:Body: {
  "query": "Did this patient have a Outpatient procedure encounter on 2013-04-08?",
  "session_id": "verified-eval-19",
  "patient_id": "0916adfb-4f71-43ae-9a95-0f89156130bd"
}
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Outpatient+procedure+encounter&maxList=1 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:21:52,314 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:21:52,314 - api.access - INFO - Body: {
  "query": "Encounter outpatient procedure 2013-04-08",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0916adfb-4f71-43ae-9a95-0f89156130bd"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Encounter outpatient procedure 2013-04-08",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "0916adfb-4f71-43ae-9a95-0f89156130bd"
  },
  "include_full_json": true
}
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  2.39it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  3.89it/s]
2026-02-02 18:21:55,050 - api.access - INFO - Response: 200 in 2.7354s
INFO:api.access:Response: 200 in 2.7354s
INFO:     127.0.0.1:55046 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z00.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:22:04,480 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:22:04,480 - api.access - INFO - Body: {
  "query": "Procedure/123",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Procedure/123",
  "k_retrieve": 20,
  "k_return": 1,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:22:06,481 - api.access - INFO - Response: 200 in 2.0011s
INFO:api.access:Response: 200 in 2.0011s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55070 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z00.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:22:12,422 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:22:12,422 - api.access - INFO - Body: {
  "query": "Procedure/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Procedure/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:22:14,380 - api.access - INFO - Response: 200 in 1.9585s
INFO:api.access:Response: 200 in 1.9585s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55078 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z00.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:22:21,213 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:22:21,213 - api.access - INFO - Body: {
  "query": "Procedure/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "Procedure/123",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14089' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14172' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14230' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14284' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 18:22:23,303 - api.access - INFO - Response: 200 in 2.0908s
INFO:api.access:Response: 200 in 2.0908s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55087 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z40.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:22:29,817 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 18:22:29,817 - api.access - INFO - Body: {
  "query": "procedure for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "procedure for patient f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8",
  "k_retrieve": 20,
  "k_return": 3,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
2026-02-02 18:22:31,886 - api.access - INFO - Response: 200 in 2.0686s
INFO:api.access:Response: 200 in 2.0686s
Warning: Only found 0/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:55095 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8000/retrieval/rerank/with-context "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: GET https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?sf=code%2Cname&terms=Z00.0&maxList=10 "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
INFO:httpx:HTTP Request: POST http://100.91.76.71:11434/api/chat "HTTP/1.1 200 OK"
2026-02-02 18:22:37,356 - api.access - INFO - Response: 200 in 48.0536s
INFO:api.access:Response: 200 in 48.0536s
Warning: Failed to store session turn: Float types are not supported. Use Decimal types instead.
INFO:     127.0.0.1:55040 - "POST /agent/query HTTP/1.1" 200 OK
2026-02-02 20:46:32,173 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 20:46:32,175 - api.access - INFO - Body: {
  "query": "hypertension",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "hypertension",
  "k_retrieve": 40,
  "k_return": 10,
  "include_full_json": true
}
Batches:   0%|          | 0/2 [00:00<?, ?it/s]Batches:  50%|█████     | 1/2 [00:00<00:00,  1.86it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  3.20it/s]Batches: 100%|██████████| 2/2 [00:00<00:00,  2.89it/s]
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14450' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
2026-02-02 20:46:38,771 - api.access - INFO - Response: 200 in 6.5980s
INFO:api.access:Response: 200 in 6.5980s
INFO:     127.0.0.1:61937 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
2026-02-02 20:46:50,686 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 20:46:50,686 - api.access - INFO - Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
INFO:api.access:Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": null
}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.86it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  6.86it/s]
2026-02-02 20:46:53,958 - api.access - INFO - Response: 200 in 3.2719s
INFO:api.access:Response: 200 in 3.2719s
INFO:     127.0.0.1:61951 - "POST /retrieval/rerank HTTP/1.1" 200 OK
2026-02-02 20:47:00,102 - api.access - INFO - Request: POST /retrieval/rerank/with-context
INFO:api.access:Request: POST /retrieval/rerank/with-context
2026-02-02 20:47:00,102 - api.access - INFO - Body: {
  "query": "chest pain and I25.1",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
INFO:api.access:Body: {
  "query": "chest pain and I25.1",
  "k_retrieve": 40,
  "k_return": 10,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  },
  "include_full_json": true
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14466' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 19.79it/s]
2026-02-02 20:47:04,914 - api.access - INFO - Response: 200 in 4.8120s
INFO:api.access:Response: 200 in 4.8120s
INFO:     127.0.0.1:61959 - "POST /retrieval/rerank/with-context HTTP/1.1" 200 OK
2026-02-02 20:47:18,128 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 20:47:18,129 - api.access - INFO - Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14339' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14394' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14479' coro=<queue_worker() running at /Users/raph/Documents/hc_ai/api/database/postgres.py:727> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 22.38it/s]
2026-02-02 20:47:25,061 - api.access - INFO - Response: 200 in 6.9325s
INFO:api.access:Response: 200 in 6.9325s
INFO:     127.0.0.1:62000 - "POST /retrieval/rerank HTTP/1.1" 200 OK
2026-02-02 20:47:34,471 - api.access - INFO - Request: POST /retrieval/rerank
INFO:api.access:Request: POST /retrieval/rerank
2026-02-02 20:47:34,472 - api.access - INFO - Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
INFO:api.access:Body: {
  "query": "chest pain",
  "k_retrieve": 10,
  "k_return": 5,
  "filter_metadata": {
    "patient_id": "f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8"
  }
}
2026-02-02 20:47:40,568 - api.access - INFO - Response: 200 in 6.0970s
INFO:api.access:Response: 200 in 6.0970s
Warning: Only found 2/50 results after filtering from 5000 candidates (patient_id=f1d2d1e2-4a03-43cb-8f06-f68c90e96cc8)
INFO:     127.0.0.1:62064 - "POST /retrieval/rerank HTTP/1.1" 200 OK
